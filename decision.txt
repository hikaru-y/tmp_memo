ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã¨ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
ãƒãƒ£ãƒƒãƒˆå±¥æ­´

ã‚ãªãŸ:
Nuxt3ã€Vuetifyã§æ¥­å‹™ç”¨ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚
ãƒ•ã‚©ãƒ¼ãƒ ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã€propsã‚„piniaã‚„apiã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚ˆã£ã¦ã€ã€Œè¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã€ã¨ã€Œç·¨é›†å¯èƒ½ã‹ã©ã†ã‹ã€ã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã©ã®çŠ¶æ…‹ã«ãªã‚Œã°ã„ã„ã®ã‹ã¯ã‚¨ã‚¯ã‚»ãƒ«ã®è¡¨ã§ãƒãƒˆãƒªã‚¯ã‚¹ã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ã‚¹ãƒãƒ¼ãƒˆã«ç®¡ç†ã—ã¦ã„ããŸã„ã®ã§ã€ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†æ–¹æ³•ã®å®Ÿè£…ã‚’æ‰‹ä¼ã£ã¦ã»ã—ã„ã§ã™ã€‚
ChatGPT:
ãªã‚‹ã»ã©ï¼æ¥­å‹™ã‚¢ãƒ—ãƒªã ã¨ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã€ã€ŒçŠ¶æ…‹ã€ã€Œç”»é¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ–°è¦/ç·¨é›†/é–²è¦§ï¼‰ã€ãªã©ã«ã‚ˆã£ã¦
å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ç¤ºå¯å¦ï¼ˆvisibleï¼‰ ã¨ ç·¨é›†å¯å¦ï¼ˆeditableï¼‰ ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã­ã€‚

ã‚¨ã‚¯ã‚»ãƒ«ã§ãƒãƒˆãƒªã‚¯ã‚¹ç®¡ç†ã—ã¦ã„ã‚‹ãªã‚‰ã€ãã‚Œã‚’è¨­å®šãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã‚¢ãƒ—ãƒªã«å–ã‚Šè¾¼ã‚“ã§ä¸€å…ƒç®¡ç†ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¾ã™ã€‚

ğŸ¯ å®Ÿç¾ã‚¤ãƒ¡ãƒ¼ã‚¸
å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« çŠ¶æ…‹åˆ¶å¾¡ãƒ«ãƒ¼ãƒ« ã‚’å®šç¾©ï¼ˆãƒãƒˆãƒªã‚¯ã‚¹ã‚’ã‚³ãƒ¼ãƒ‰åŒ–ï¼‰

ãƒ«ãƒ¼ãƒ«ã¯ JSON ã¾ãŸã¯ TypeScript ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ã§æŒã¤

å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€Œãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€ã‚’ã‚­ãƒ¼ã«ã—ã¦
ã€Œvisibleã€ã€Œeditableã€ã‚’å‹•çš„ã«å‚ç…§

è¡¨ç¤ºãƒ»ç·¨é›†å¯å¦ã‚’ v-if ã‚„ :disabled ã«æ¸¡ã™

1. ãƒ«ãƒ¼ãƒ«å®šç¾©ï¼ˆã‚¨ã‚¯ã‚»ãƒ«ã‚’ã‚³ãƒ¼ãƒ‰åŒ–ï¼‰
ã‚¨ã‚¯ã‚»ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹è¡¨ã‚’ JSON/TS ã«è½ã¨ã™ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

// fieldRules.ts
export type FieldRule = {
  visible: boolean;
  editable: boolean;
};

export type FormState = "create" | "edit" | "view";

export const fieldRules: Record<FormState, Record<string, FieldRule>> = {
  create: {
    name: { visible: true, editable: true },
    email: { visible: true, editable: true },
    status: { visible: false, editable: false },
  },
  edit: {
    name: { visible: true, editable: false },
    email: { visible: true, editable: true },
    status: { visible: true, editable: true },
  },
  view: {
    name: { visible: true, editable: false },
    email: { visible: true, editable: false },
    status: { visible: true, editable: false },
  },
};
2. composable ã§ç®¡ç†
// useFieldControl.ts
import { computed } from "vue";
import { fieldRules, FormState } from "@/config/fieldRules";

export function useFieldControl(formState: FormState) {
  const getFieldRule = (field: string) =>
    fieldRules[formState][field] ?? { visible: false, editable: false };

  return {
    getFieldRule,
    isVisible: (field: string) => computed(() => getFieldRule(field).visible),
    isEditable: (field: string) => computed(() => getFieldRule(field).editable),
  };
}
3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§åˆ©ç”¨
<script setup lang="ts">
import { useFieldControl } from "@/composables/useFieldControl";

const formState = "edit"; // props ã‚„ pinia ã‹ã‚‰æ³¨å…¥ã•ã‚Œã‚‹
const { isVisible, isEditable } = useFieldControl(formState);

const form = reactive({
  name: "",
  email: "",
  status: "",
});
</script>

<template>
  <v-form>
    <v-text-field
      v-if="isVisible('name')"
      v-model="form.name"
      :disabled="!isEditable('name')"
      label="Name"
    />
    <v-text-field
      v-if="isVisible('email')"
      v-model="form.email"
      :disabled="!isEditable('email')"
      label="Email"
    />
    <v-select
      v-if="isVisible('status')"
      v-model="form.status"
      :disabled="!isEditable('status')"
      :items="['active', 'inactive']"
      label="Status"
    />
  </v-form>
</template>
4. ç™ºå±•ç³»
ã‚¨ã‚¯ã‚»ãƒ«ç®¡ç†ã‚’ç¶­æŒã—ãŸã„
â†’ JSON å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€ãã®ã¾ã¾èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹

Pinia é€£æº
â†’ ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ï¼ˆcreate/edit/viewï¼‰ã‚’ store ã«å…¥ã‚Œã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆ¶å¾¡

è¤‡é›‘æ¡ä»¶å¯¾å¿œ

APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã«ã‚ˆã‚‹æ¡ä»¶åˆ†å²ã‚’
computed ã§ãƒ«ãƒ¼ãƒ«ã«çµ„ã¿è¾¼ã‚€

ä¾‹:

const getFieldRule = (field: string, userRole: string) => {
  const base = fieldRules[formState][field] ?? { visible: false, editable: false };
  if (userRole === "admin") {
    return { ...base, editable: true }; // ç®¡ç†è€…ã¯å¸¸ã«ç·¨é›†å¯
  }
  return base;
};
âœ… ã“ã®æ–¹æ³•ã ã¨

ãƒ•ã‚©ãƒ¼ãƒ UIã‹ã‚‰åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã§ãã‚‹

Excelã®ãƒ«ãƒ¼ãƒ«ã‚’ãã®ã¾ã¾ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã§ãã‚‹

çŠ¶æ…‹è¿½åŠ ï¼ˆæ–°ã—ã„ç”»é¢ãƒ¢ãƒ¼ãƒ‰ãƒ»æ¨©é™ãªã©ï¼‰ã‚‚è¨­å®šã ã‘ã§å¯¾å¿œå¯èƒ½

ã”è³ªå•ã§ã™ãŒã€
ä»Šç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã‚¨ã‚¯ã‚»ãƒ«ã®ãƒãƒˆãƒªã‚¯ã‚¹ã£ã¦ã€

ã€Œç”»é¢ãƒ¢ãƒ¼ãƒ‰ Ã— ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã ã‘ãªã®ã‹

ãã‚Œã¨ã‚‚ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ Ã— APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ Ã— ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã®ã‚ˆã†ã«è¤‡é›‘æ¡ä»¶ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ã®ã‹

ã©ã¡ã‚‰ã§ã—ã‚‡ã†ï¼Ÿ
ãã‚Œã«ã‚ˆã£ã¦å®Ÿè£…ã®ç²’åº¦ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ–¹å¼ or ãƒ­ã‚¸ãƒƒã‚¯æ–¹å¼ï¼‰ãŒå¤‰ã‚ã£ã¦ãã¾ã™ã€‚

ã‚ãªãŸ:
å°‘ã—ãšã¤æ•´ç†ã—ã¦ã„ããŸã„ã®ã§ã€æ‰‹ä¼ã£ã¦ãã ã•ã„ã€‚
ã¾ãšã€ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯enumã§å®šç¾©ã™ã‚‹æ–¹å‘ã§ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚
export enum DecisionField {
  DocType,
  DocName,
  DocSubject,
  CreatedAt,
  PrimaryFlg,
}
æœ¬å½“ã¯ã‚‚ã£ã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ•°ã¯ã‚ã‚‹ã®ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãšã“ã‚Œã‚’ãŸãŸãå°ã«ã—ãŸã„ã§ã™ã€‚
ChatGPT:
ã„ã„ã§ã™ã­ï¼enum ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®šç¾©ã—ã¦ãŠãã¨ã€

å‹å®‰å…¨ã«ç®¡ç†ã§ãã‚‹

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®typoã‚’é˜²ã’ã‚‹

ãƒ«ãƒ¼ãƒ«å®šç¾©ã‚„ãƒ•ã‚©ãƒ¼ãƒ ç”Ÿæˆã«æµç”¨ã—ã‚„ã™ã„

ã¨ã„ã£ãŸãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ ğŸ‘

ã¾ãšã¯ enum ã‚’ãƒ™ãƒ¼ã‚¹ã«ãƒ«ãƒ¼ãƒ«ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ ã‚’æœ€å°é™ã§ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
// fields.ts
export enum DecisionField {
  DocType = "DocType",
  DocName = "DocName",
  DocSubject = "DocSubject",
  CreatedAt = "CreatedAt",
  PrimaryFlg = "PrimaryFlg",
}
ğŸ‘‰ enum ã®å€¤ã‚’æ–‡å­—åˆ—ã«ã—ã¦ãŠãã¨ã€JSONåŒ–ã‚„å¤–éƒ¨é€£æºï¼ˆExcelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç­‰ï¼‰ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚
ï¼ˆæ•°å­—ã§ã‚‚ã„ã„ã§ã™ãŒ "DocType" ã®ã‚ˆã†ã«ã—ã¦ãŠãã¨äººé–“ã«ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ï¼‰

2. ãƒ«ãƒ¼ãƒ«ã®å‹å®šç¾©
// fieldRules.ts
import { DecisionField } from "./fields";

export type FieldRule = {
  visible: boolean;
  editable: boolean;
};

// ä¾‹ãˆã°ãƒ•ã‚©ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’å®šç¾©
export type FormState = "create" | "edit" | "view";

// ã€ŒFormState Ã— Fieldã€ã®ãƒãƒˆãƒªã‚¯ã‚¹
export const fieldRules: Record<FormState, Record<DecisionField, FieldRule>> = {
  create: {
    [DecisionField.DocType]:    { visible: true,  editable: true },
    [DecisionField.DocName]:    { visible: true,  editable: true },
    [DecisionField.DocSubject]: { visible: true,  editable: true },
    [DecisionField.CreatedAt]:  { visible: false, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true,  editable: true },
  },
  edit: {
    [DecisionField.DocType]:    { visible: true,  editable: false },
    [DecisionField.DocName]:    { visible: true,  editable: true },
    [DecisionField.DocSubject]: { visible: true,  editable: true },
    [DecisionField.CreatedAt]:  { visible: true,  editable: false },
    [DecisionField.PrimaryFlg]: { visible: true,  editable: true },
  },
  view: {
    [DecisionField.DocType]:    { visible: true,  editable: false },
    [DecisionField.DocName]:    { visible: true,  editable: false },
    [DecisionField.DocSubject]: { visible: true,  editable: false },
    [DecisionField.CreatedAt]:  { visible: true,  editable: false },
    [DecisionField.PrimaryFlg]: { visible: true,  editable: false },
  },
};
3. composable ã§å–ã‚Šå‡ºã™
// useFieldControl.ts
import { computed } from "vue";
import { DecisionField } from "@/config/fields";
import { fieldRules, FormState } from "@/config/fieldRules";

export function useFieldControl(formState: FormState) {
  const getFieldRule = (field: DecisionField) =>
    fieldRules[formState][field] ?? { visible: false, editable: false };

  return {
    getFieldRule,
    isVisible: (field: DecisionField) =>
      computed(() => getFieldRule(field).visible),
    isEditable: (field: DecisionField) =>
      computed(() => getFieldRule(field).editable),
  };
}
4. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ã†ä¾‹
<script setup lang="ts">
import { DecisionField } from "@/config/fields";
import { useFieldControl } from "@/composables/useFieldControl";

const formState = "edit"; // propsã‚„piniaã‹ã‚‰å–å¾—
const { isVisible, isEditable } = useFieldControl(formState);

const form = reactive({
  [DecisionField.DocType]: "",
  [DecisionField.DocName]: "",
  [DecisionField.DocSubject]: "",
  [DecisionField.CreatedAt]: "",
  [DecisionField.PrimaryFlg]: false,
});
</script>

<template>
  <v-form>
    <v-text-field
      v-if="isVisible(DecisionField.DocType)"
      v-model="form[DecisionField.DocType]"
      :disabled="!isEditable(DecisionField.DocType)"
      label="Document Type"
    />
    <v-text-field
      v-if="isVisible(DecisionField.DocName)"
      v-model="form[DecisionField.DocName]"
      :disabled="!isEditable(DecisionField.DocName)"
      label="Document Name"
    />
    <!-- ä»¥ä¸‹çœç•¥ -->
  </v-form>
</template>
ã“ã‚Œã§ã¾ãš enum â†’ ãƒ«ãƒ¼ãƒ« â†’ composable â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ã®æµã‚ŒãŒã§ãã¾ã—ãŸã€‚
ã‚ã¨ã¯å¾ã€…ã«è¤‡é›‘ãªæ¡ä»¶ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã€APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾å­˜ãªã©ï¼‰ã‚’ãƒ«ãƒ¼ãƒ«ã‚„é–¢æ•°ã«çµ„ã¿è¾¼ã‚ã¾ã™ã€‚

ğŸ‘‰ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã¯ã€

ãƒ«ãƒ¼ãƒ«ã‚’ å›ºå®šã®è¡¨ï¼ˆã‚³ãƒ¼ãƒ‰åŒ–ï¼‰ ã§æŒã¤ã®ã‹

Excel â†’ JSON ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ å¤–éƒ¨å®šç¾© ã§èª­ã¿è¾¼ã‚€ã®ã‹

ã‚’æ±ºã‚ã‚‹ã¨æ‹¡å¼µæ€§ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚

ã©ã¡ã‚‰ã‚’å„ªå…ˆã—ãŸã„ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ãã“ã«é€²ã‚€å‰ã«ã€ã¾ãšãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ã—ãŸã„ã§ã™ã€‚
ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯
export enum DecisionField {
  DocType,
  DocName,
  DocSubject,
  CreatedAt,
  PrimaryFlg,
}

ãƒšãƒ¼ã‚¸ã®ãƒ¢ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚


export enum DocMode {
  Create,
  Edit,
  EditAfterProposal,
  View,
}

ã§ã€decision.vueã¯ä»Šã®ã¨ã“ã‚ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™
<script setup lang="ts">
import type { DocMode } from '~/composables/tmp';

type Props = {
  docMode: DocMode;
  consttType: string;
  submissionType: string;
  freeInput: boolean;
};

defineProps<Props>();
</script>

<template>
</template>


ChatGPT:
ãªã‚‹ã»ã© ğŸ‘
ä»Šã®æ®µéšã§ã¯ ã€Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€è¦§ï¼ˆDecisionFieldï¼‰ã€ ã¨ ã€Œãƒ¢ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆDocModeï¼‰ã€ ãŒæ•´ç†ã§ãã¦ã€decision.vue ã§ã¯ props ã¨ã—ã¦ docMode ã‚„å‘¨è¾ºæ¡ä»¶ã‚’å—ã‘å–ã‚‹å½¢ã«ãªã£ã¦ã¾ã™ã­ã€‚

ã“ã“ã§æ•´ç†ã—ã¦ãŠãã¨å¾Œã§ãƒ«ãƒ¼ãƒ«ç®¡ç†ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã¯ã€ã€Œã©ã®è»¸ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹ãŒæ±ºã¾ã‚‹ã‹ã€ ã‚’ã¯ã£ãã‚Šã•ã›ã‚‹ã“ã¨ã§ã™ã€‚

1. ç¾çŠ¶ã®è»¸
ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: DecisionField

ãƒ¢ãƒ¼ãƒ‰: DocMode

propsã‹ã‚‰æ¸¡ã•ã‚Œã‚‹è¿½åŠ æ¡ä»¶:

constType: string

submissionType: string

freeInput: boolean

2. ä»Šå¾Œã®ãƒ«ãƒ¼ãƒ«è¨­è¨ˆã§å¿…è¦ãã†ãªã“ã¨
â‘  ã€Œæœ€å°ãƒãƒˆãƒªã‚¯ã‚¹ã€
ã¾ãšã¯ã€ŒDocMode Ã— Field â†’ visible/editableã€ã‚’åŸºæœ¬ãƒãƒˆãƒªã‚¯ã‚¹ã«ã™ã‚‹ã®ãŒã‚ˆã„ã§ã™ã€‚
ã“ã‚Œã¯ Excel ã®è¡¨ã¨ä¸€ç•ªå¯¾å¿œã—ã‚„ã™ã„ã€‚

ä¾‹ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰:

Field	Create (è¡¨ç¤º/ç·¨é›†)	Edit (è¡¨ç¤º/ç·¨é›†)	EditAfterProposal (è¡¨ç¤º/ç·¨é›†)	View (è¡¨ç¤º/ç·¨é›†)
DocType	â—‹/â—‹	â—‹/Ã—	â—‹/Ã—	â—‹/Ã—
DocName	â—‹/â—‹	â—‹/â—‹	â—‹/Ã—	â—‹/Ã—
DocSubject	â—‹/â—‹	â—‹/â—‹	â—‹/â—‹	â—‹/Ã—
CreatedAt	Ã—/Ã—	â—‹/Ã—	â—‹/Ã—	â—‹/Ã—
PrimaryFlg	â—‹/â—‹	â—‹/â—‹	â—‹/Ã—	â—‹/Ã—
â‘¡ ã€Œè¿½åŠ æ¡ä»¶ã«ã‚ˆã‚‹åˆ†å²ã€
æ¬¡ã« constType, submissionType, freeInput ã®ã‚ˆã†ãª ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã®è¿½åŠ æ¡ä»¶ ã‚’çµ„ã¿è¾¼ã‚€å¿…è¦ãŒå‡ºã¾ã™ã€‚

ä¾‹ãˆã°:

freeInput = false ã®ã¨ã DocSubject ã¯ç·¨é›†ä¸å¯

submissionType = "draft" ã®ã¨ãã ã‘ PrimaryFlg ã‚’éš ã™

constType = "X" ã®ã¨ã DocType ã¯ç·¨é›†ä¸å¯

ã“ã†ã„ã£ãŸæ¡ä»¶ã‚’ åŸºæœ¬ãƒãƒˆãƒªã‚¯ã‚¹ã«å¾Œä»˜ã‘ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹å½¢ ã«ã™ã‚Œã°æ•´ç†ã—ã‚„ã™ã„ã§ã™ã€‚

3. æ•´ç†æ–¹é‡ï¼ˆææ¡ˆï¼‰
åŸºæœ¬ãƒ«ãƒ¼ãƒ«: DocMode Ã— DecisionField ã®ãƒãƒˆãƒªã‚¯ã‚¹ã‚’å®šç¾©ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰

è¿½åŠ æ¡ä»¶ãƒ«ãƒ¼ãƒ«: props ã‚’è¦‹ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ composable ã§å®Ÿè£…

4. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ãŸãŸãå°
// fieldRules.ts
import { DecisionField } from "./fields";
import { DocMode } from "./modes";

export type FieldRule = {
  visible: boolean;
  editable: boolean;
};

export const baseRules: Record<DocMode, Record<DecisionField, FieldRule>> = {
  [DocMode.Create]: {
    [DecisionField.DocType]:    { visible: true, editable: true },
    [DecisionField.DocName]:    { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]:  { visible: false, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: true },
  },
  [DocMode.Edit]: {
    [DecisionField.DocType]:    { visible: true, editable: false },
    [DecisionField.DocName]:    { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]:  { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: true },
  },
  [DocMode.EditAfterProposal]: {
    [DecisionField.DocType]:    { visible: true, editable: false },
    [DecisionField.DocName]:    { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]:  { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  },
  [DocMode.View]: {
    [DecisionField.DocType]:    { visible: true, editable: false },
    [DecisionField.DocName]:    { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: true, editable: false },
    [DecisionField.CreatedAt]:  { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  },
};
5. decision.vue ã§ã®ä½¿ã„æ–¹ã‚¤ãƒ¡ãƒ¼ã‚¸
<script setup lang="ts">
import { baseRules } from "@/config/fieldRules";
import { DecisionField } from "@/config/fields";
import { DocMode } from "@/config/modes";

type Props = {
  docMode: DocMode;
  constType: string;
  submissionType: string;
  freeInput: boolean;
};
const props = defineProps<Props>();

// åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã‚’å‚ç…§
const getRule = (field: DecisionField) => {
  const base = baseRules[props.docMode][field];

  // --- è¿½åŠ æ¡ä»¶ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ä¾‹ ---
  if (field === DecisionField.DocSubject && !props.freeInput) {
    return { ...base, editable: false };
  }
  if (field === DecisionField.PrimaryFlg && props.submissionType === "draft") {
    return { ...base, visible: false };
  }

  return base;
};
</script>

<template>
  <v-text-field
    v-if="getRule(DecisionField.DocName).visible"
    v-model="form.docName"
    :disabled="!getRule(DecisionField.DocName).editable"
    label="Document Name"
  />
</template>
ã“ã“ã¾ã§ã§ã€
âœ… enum ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ»ãƒ¢ãƒ¼ãƒ‰ã‚’å®šç¾©
âœ… åŸºæœ¬ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆDocMode Ã— Fieldï¼‰ã‚’ä½œæˆ
âœ… è¿½åŠ æ¡ä»¶ï¼ˆpropsï¼‰ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰

ã¨ã„ã†ä»•çµ„ã¿ãŒæ•´ç†ã§ãã¾ã™ã€‚

è³ªå•ã§ã™ âœ‹
Excel ã«æ•´ç†ã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«ã¯ã€ŒDocMode Ã— Fieldã€ã®åŸºæœ¬å½¢ã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€ŒDocMode Ã— Fieldã€ã«åŠ ãˆã¦ constType ã‚„ submissionType ãªã©ã®æ¡ä»¶ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ãƒ«ãƒ¼ãƒ«ã¯ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ãŸã„ã§ã™ã€‚computedã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã‹
ChatGPT:
ã„ã„è¦–ç‚¹ã§ã™ï¼

çµè«–ã‹ã‚‰ã„ã†ã¨ï¼š

ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ãŸã„ãªã‚‰ computed ã‚’ä½¿ã†ã®ãŒãƒ™ã‚¹ãƒˆ ã§ã™ã€‚

ãŸã ã—ã€å…¨ã‚±ãƒ¼ã‚¹ã§ computed ãŒå¿…è¦ã¨ã„ã†ã‚ã‘ã§ã¯ãªãã€ã€Œprops ã‚„ store ã®å€¤ã«ä¾å­˜ã™ã‚‹å ´åˆã€ã«ä½¿ãˆã°ååˆ†ã§ã™ã€‚

ãªãœ computed ãŒå¿…è¦ã‹ï¼Ÿ
decision.vue ã®å ´åˆã€ãƒ«ãƒ¼ãƒ«ã¯

docModeï¼ˆpropsï¼‰

constTypeï¼ˆpropsï¼‰

submissionTypeï¼ˆpropsï¼‰

freeInputï¼ˆpropsï¼‰

ãªã©ã«ä¾å­˜ã—ã¾ã™ã€‚
ã“ã‚Œã‚‰ãŒå¤‰åŒ–ã—ãŸã‚‰ãƒ«ãƒ¼ãƒ«ã‚‚è‡ªå‹•çš„ã«å¤‰ã‚ã£ã¦ã»ã—ã„ã§ã™ã‚ˆã­ï¼Ÿ

ğŸ‘‰ ãã®ã¨ãã« computed ã‚’ä½¿ã†ã¨ ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ä¾å­˜é–¢ä¿‚ã‚’è¿½è·¡ã§ãã¾ã™ã€‚

å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸
<script setup lang="ts">
import { baseRules } from "@/config/fieldRules";
import { DecisionField } from "@/config/fields";
import { DocMode } from "@/config/modes";

type Props = {
  docMode: DocMode;
  constType: string;
  submissionType: string;
  freeInput: boolean;
};
const props = defineProps<Props>();

// ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã®ãƒ«ãƒ¼ãƒ«ã‚’ reactive/computed ã§è¿”ã™
const getRule = (field: DecisionField) =>
  computed(() => {
    const base = baseRules[props.docMode][field];

    // --- è¿½åŠ æ¡ä»¶ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ä¾‹ ---
    if (field === DecisionField.DocSubject && !props.freeInput) {
      return { ...base, editable: false };
    }
    if (field === DecisionField.PrimaryFlg && props.submissionType === "draft") {
      return { ...base, visible: false };
    }

    return base;
  });
</script>

<template>
  <v-text-field
    v-if="getRule(DecisionField.DocName).value.visible"
    v-model="form.docName"
    :disabled="!getRule(DecisionField.DocName).value.editable"
    label="Document Name"
  />
</template>
ãƒã‚¤ãƒ³ãƒˆ
computed ã‚’ä½¿ãˆã° props ãŒå¤‰ã‚ã£ãŸã¨ãã«ãƒ«ãƒ¼ãƒ«ã‚‚å†è¨ˆç®—ã•ã‚Œã¾ã™ã€‚

ã€Œã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¯¾ã—ã¦ computed ã‚’æ¯å›å‘¼ã¶ã®ã¯é¢å€’â€¦ã€ãªã‚‰ã€
ä¸€æ‹¬ã§ reactive ãªãƒ«ãƒ¼ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™æ–¹æ³•ã‚‚ã‚¢ãƒªã§ã™ã€‚

ä¸€æ‹¬ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³
const rules = computed(() => {
  const current = baseRules[props.docMode];
  return {
    [DecisionField.DocType]: {
      ...current[DecisionField.DocType],
    },
    [DecisionField.DocName]: {
      ...current[DecisionField.DocName],
    },
    [DecisionField.DocSubject]: {
      ...current[DecisionField.DocSubject],
      editable: props.freeInput ? current[DecisionField.DocSubject].editable : false,
    },
    [DecisionField.CreatedAt]: {
      ...current[DecisionField.CreatedAt],
    },
    [DecisionField.PrimaryFlg]: {
      ...current[DecisionField.PrimaryFlg],
      visible:
        props.submissionType === "draft"
          ? false
          : current[DecisionField.PrimaryFlg].visible,
    },
  };
});
Vue ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ã“ã†ä½¿ãˆã¾ã™:

<v-text-field
  v-if="rules[DecisionField.DocName].visible"
  v-model="form.docName"
  :disabled="!rules[DecisionField.DocName].editable"
/>
âœ… ã¾ã¨ã‚ã‚‹ã¨ï¼š

ãƒ«ãƒ¼ãƒ«ãŒ props ã‚„ store ã®çŠ¶æ…‹ã«ä¾å­˜ã™ã‚‹ãªã‚‰ computed ã«ã™ã‚‹ã¹ã

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«å€‹åˆ¥ computed ã§ã‚‚ã„ã„ã—ã€ã¾ã¨ã‚ã¦ rules ã‚’ computed ã«ã—ã¦ã‚‚ã„ã„

ã”è³ªå•ã§ã™ãŒã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°ã¯çµæ§‹å¤šã„ã§ã™ã‹ï¼Ÿ
ã‚‚ã—æ•°åé …ç›®ã‚ã‚‹ãªã‚‰ã€Œä¸€æ‹¬ç”Ÿæˆã€ã®ã»ã†ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ãŒã€å°‘ãªã„ãªã‚‰ã€ŒgetRule(field) ã‚’ computed ã«ã™ã‚‹ã€æ–¹å¼ã§ã‚‚è‰¯ã„ã§ã™ã€‚

ã‚ãªãŸ:
form.docNameã®formã‚’refã§å®šç¾©ã—ã¦ã‚‚è‰¯ã„ã§ã™ã‹
ChatGPT:
ã¯ã„ ğŸ‘ form ã‚’ ref ã§å®šç¾©ã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
ãŸã ã—ã€Vue 3 ã§ã¯ ref ã¨ reactive ã§æ‰±ã„æ–¹ãŒå°‘ã—é•ã†ã®ã§æ•´ç†ã—ã¦ãŠãã¾ã™ã€‚

1. reactive ã®å ´åˆï¼ˆã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
const form = reactive({
  docType: "",
  docName: "",
  docSubject: "",
  createdAt: "",
  primaryFlg: false,
});
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ãã®ã¾ã¾å‚ç…§ã§ãã¾ã™ï¼š

<v-text-field v-model="form.docName" />
2. ref ã®å ´åˆï¼ˆOKã ã‘ã©ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ãŒé•ã†ï¼‰
const form = ref({
  docType: "",
  docName: "",
  docSubject: "",
  createdAt: "",
  primaryFlg: false,
});
ã“ã®å ´åˆã€form è‡ªä½“ãŒ Ref<{...}> ã«ãªã‚‹ã®ã§ã€ä¸­èº«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ .value ãŒå¿…è¦ã§ã™ã€‚

<v-text-field v-model="form.value.docName" />
3. ã©ã¡ã‚‰ãŒè‰¯ã„ã‹ï¼Ÿ
reactive

ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã‚’ã²ã¨ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ‰±ã†ãªã‚‰ã“ã‚ŒãŒè‡ªç„¶

v-model="form.docName" ã®ã‚ˆã†ã«ã‚·ãƒ³ãƒ—ãƒ«ã«æ›¸ã‘ã‚‹

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°ãŒå¤šã„æ¥­å‹™ã‚¢ãƒ—ãƒªã§ã¯ã“ã¡ã‚‰ãŒãŠã™ã™ã‚

ref

APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚„ props ä¸¸ã”ã¨ã‚’ä¸€æ—¦ ref ã«å…¥ã‚Œã‚‹å ´åˆã«ä½¿ã„ã‚„ã™ã„

form.value.xxx ã¨æ›¸ãå¿…è¦ãŒã‚ã‚‹ã®ã§ãƒ•ã‚©ãƒ¼ãƒ ç”¨é€”ã§ã¯ã¡ã‚‡ã£ã¨å†—é•·

âœ… çµè«–:

ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ç”¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ reactive ãŒä¸€èˆ¬çš„ã§ãŠã™ã™ã‚

ç‰¹åˆ¥ãªç†ç”±ï¼ˆform ã‚’åˆ¥ã®å‹ä»˜ãã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å·®ã—æ›¿ãˆãŸã„ç­‰ï¼‰ãŒã‚ã‚‹ãªã‚‰ ref ã§ã‚‚OK

è³ªå•ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã•ã‚“ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€Œform ã‚’ API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ä¸¸ã”ã¨å·®ã—æ›¿ãˆã‚‹ã€ã“ã¨ã¯ã‚ã‚Šãã†ã§ã™ã‹ï¼Ÿ
ï¼ˆã‚‚ã—ãã†ãªã‚‰ ref ã®ã»ã†ãŒç›¸æ€§ã„ã„ã§ã™ã—ã€ãã†ã§ãªã‘ã‚Œã° reactive ã®ã»ã†ãŒæ›¸ãã‚„ã™ã„ã§ã™ï¼‰

ã‚ãªãŸ:
ã¯ã„ã€ã‚ã‚Šã¾ã™ã€‚refã§å®šç¾©ã—ãŸã„ã§ã™
ChatGPT:
äº†è§£ã§ã™ ğŸ‘
API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ form ã‚’ä¸¸ã”ã¨å·®ã—æ›¿ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãªã‚‰ã€ref ã§å®šç¾©ã™ã‚‹ã®ãŒæ­£è§£ã§ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼ˆref ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
<script setup lang="ts">
import { ref, onMounted } from "vue";

type FormData = {
  docType: string;
  docName: string;
  docSubject: string;
  createdAt: string;
  primaryFlg: boolean;
};

// ãƒ•ã‚©ãƒ¼ãƒ ã‚’refã§å®šç¾©
const form = ref<FormData>({
  docType: "",
  docName: "",
  docSubject: "",
  createdAt: "",
  primaryFlg: false,
});

// API ã‹ã‚‰å–å¾—ã—ã¦ä¸¸ã”ã¨ä»£å…¥
onMounted(async () => {
  const res = await $fetch<FormData>("/api/document/123");
  form.value = res;
});
</script>

<template>
  <v-form>
    <v-text-field
      v-model="form.value.docName"
      label="Document Name"
    />
    <v-text-field
      v-model="form.value.docSubject"
      label="Document Subject"
    />
    <v-select
      v-model="form.value.docType"
      :items="['report','memo','proposal']"
      label="Document Type"
    />
  </v-form>
</template>
ãƒã‚¤ãƒ³ãƒˆ
form.value ãŒå¿…é ˆ

ref ã§å®šç¾©ã—ãŸã®ã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ã¯å¿…ãš .value ã‚’ä»˜ã‘ã‚‹ã€‚

reactive ã®å ´åˆã¯ä¸è¦ã ã£ãŸéƒ¨åˆ†ã€‚

API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ãã®ã¾ã¾ä¸Šæ›¸ãã§ãã‚‹

form.value = res;
reactive ã ã¨ Object.assign(form, res) ã¿ãŸã„ãªã“ã¨ã‚’ã—ãªã„ã¨å·®ã—æ›¿ãˆã§ããªã„ã®ã§ã€ref ã®æ–¹ãŒã‚·ãƒ³ãƒ—ãƒ«ã€‚

å‹å®šç¾©ã‚’ã¤ã‘ã‚‹ã¨å®‰å¿ƒ

FormData å‹ã‚’ç”¨æ„ã—ã¦ ref<FormData>(...) ã«ã™ã‚‹ã¨ã€API ã¨ã®å‹ãƒã‚§ãƒƒã‚¯ãŒåŠ¹ãã€‚

âœ… ã¾ã¨ã‚ã‚‹ã¨

API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä¸¸ã”ã¨ä»£å…¥ã—ãŸã„ãªã‚‰ ref

ç´°ã‹ã v-model="form.xxx" ã§ã‚·ãƒ³ãƒ—ãƒ«ã«æ›¸ããŸã„ãªã‚‰ reactive

è³ªå•ã§ã™ãŒï¼š
API ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã€Œãã®ã¾ã¾ãƒ•ã‚©ãƒ¼ãƒ ã«ä½¿ãˆã‚‹æ§‹é€ ã€ã«ãªã£ã¦ã„ã¾ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€Œä¸€éƒ¨ã‚’å¤‰æ›ï¼ˆä¾‹: createdAt ã‚’æ—¥ä»˜å‹ã«å¤‰æ›ï¼‰ã€ã—ã¦ã‹ã‚‰ form ã«å…¥ã‚ŒãŸã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ç·¨é›†ã¨è¡¨ç¤ºã®booleanã‚’æ±ºã‚ã‚‹è¦ç´ docmodeä»¥å¤–ã«ã‚‚ã‚ã‚Šã¾ã™ã€‚ã¾ãšä¸Šã®æ–¹ã«ã‚‚æ›¸ã„ãŸã®ã§ã™ãŒ
{ docMode: DocMode; constrType: string; submissionType: string; freeInput: boolean; };ã§ã™
ChatGPT:
ãªã‚‹ã»ã©ï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ ğŸ™Œ
æ•´ç†ã™ã‚‹ã¨ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® visible / editable ã‚’æ±ºã‚ã‚‹è¦ç´ ã¯ã€

docModeï¼ˆãƒšãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ï¼‰

constrTypeï¼ˆå·¥äº‹ç¨®åˆ¥ã¿ãŸã„ãªã‚‚ã®ï¼Ÿï¼‰

submissionTypeï¼ˆæå‡ºç¨®åˆ¥ï¼‰

freeInputï¼ˆãƒ•ãƒªãƒ¼ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›å¯å¦ï¼‰

ã® 4 ã¤ã§ã™ã­ã€‚

ğŸ¯ è¨­è¨ˆã®è€ƒãˆæ–¹
åŸºæœ¬ãƒãƒˆãƒªã‚¯ã‚¹

DocMode Ã— Field â†’ visible/editable

ã“ã‚Œã¯ã€Œã©ã®ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ç·¨é›†ã§ãã‚‹ã‹ã€ã®ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«

æ¡ä»¶ä»˜ãã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰

constrType, submissionType, freeInput ã«ã‚ˆã£ã¦ã€ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ã‚’ä¸Šæ›¸ã

ä¾‹:

freeInput = false â†’ DocSubject ã¯ editable: false

submissionType = "draft" â†’ PrimaryFlg ã¯ visible: false

constrType = "X" â†’ DocType ã¯ editable: false

å‹ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆãŸãŸãå°ï¼‰
// types.ts
import { DecisionField } from "./fields";
import { DocMode } from "./modes";

export type FieldRule = {
  visible: boolean;
  editable: boolean;
};

export type RuleContext = {
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
};
åŸºæœ¬ãƒ«ãƒ¼ãƒ«ï¼ˆãƒãƒˆãƒªã‚¯ã‚¹ï¼‰
// baseRules.ts
import { DecisionField } from "./fields";
import { DocMode } from "./modes";
import type { FieldRule } from "./types";

export const baseRules: Record<DocMode, Record<DecisionField, FieldRule>> = {
  [DocMode.Create]: {
    [DecisionField.DocType]:    { visible: true, editable: true },
    [DecisionField.DocName]:    { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]:  { visible: false, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: true },
  },
  [DocMode.Edit]: {
    [DecisionField.DocType]:    { visible: true, editable: false },
    [DecisionField.DocName]:    { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]:  { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: true },
  },
  [DocMode.EditAfterProposal]: {
    [DecisionField.DocType]:    { visible: true, editable: false },
    [DecisionField.DocName]:    { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]:  { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  },
  [DocMode.View]: {
    [DecisionField.DocType]:    { visible: true, editable: false },
    [DecisionField.DocName]:    { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: true, editable: false },
    [DecisionField.CreatedAt]:  { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  },
};
æ¡ä»¶ä»˜ãã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
// useFieldControl.ts
import { computed } from "vue";
import { baseRules } from "@/config/baseRules";
import { DecisionField } from "@/config/fields";
import type { RuleContext, FieldRule } from "@/config/types";

export function useFieldControl(ctx: RuleContext) {
  const getRule = (field: DecisionField) =>
    computed<FieldRule>(() => {
      const base = baseRules[ctx.docMode][field];

      let rule = { ...base };

      // freeInput ã®æ¡ä»¶
      if (field === DecisionField.DocSubject && !ctx.freeInput) {
        rule = { ...rule, editable: false };
      }

      // submissionType ã®æ¡ä»¶
      if (field === DecisionField.PrimaryFlg && ctx.submissionType === "draft") {
        rule = { ...rule, visible: false };
      }

      // constrType ã®æ¡ä»¶ï¼ˆä¾‹ï¼‰
      if (field === DecisionField.DocType && ctx.constrType === "X") {
        rule = { ...rule, editable: false };
      }

      return rule;
    });

  return { getRule };
}
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ã„æ–¹
<script setup lang="ts">
import { useFieldControl } from "@/composables/useFieldControl";
import { DecisionField } from "@/config/fields";
import type { DocMode } from "@/config/modes";

const props = defineProps<{
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
}>();

const { getRule } = useFieldControl(props);

const form = ref({
  docType: "",
  docName: "",
  docSubject: "",
  createdAt: "",
  primaryFlg: false,
});
</script>

<template>
  <v-text-field
    v-if="getRule(DecisionField.DocName).value.visible"
    v-model="form.value.docName"
    :disabled="!getRule(DecisionField.DocName).value.editable"
    label="Document Name"
  />
</template>
âœ… ã“ã®å½¢ãªã‚‰

åŸºæœ¬ãƒãƒˆãƒªã‚¯ã‚¹ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«å®šç¾©

è¿½åŠ æ¡ä»¶ã¯ computed ã§å‹•çš„ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰

props ãŒå¤‰ã‚ã‚Œã°ãƒ«ãƒ¼ãƒ«ã‚‚è‡ªå‹•æ›´æ–°

ã§ãã¾ã™ã€‚

ã”è³ªå•ã§ã™ãŒã€ã“ã® 4 è¦ç´ ï¼ˆdocMode, constrType, submissionType, freeInputï¼‰ä»¥å¤–ã«ã‚‚æ¡ä»¶è¦ç´ ãŒå¢—ãˆã‚‹å¯èƒ½æ€§ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
ï¼ˆã‚‚ã—å¢—ãˆã‚‹ãªã‚‰ã€Œãƒ«ãƒ¼ãƒ«ã‚’é–¢æ•°åŒ–ã—ã¦é †ç•ªã«é©ç”¨ã™ã‚‹ã€ä»•çµ„ã¿ã‚’ä½œã‚‹ã®ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ï¼‰

ã‚ãªãŸ:
ã™ã„ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€ã¤è¿½åŠ ã§ã™ã€‚DocStatusã§ã™ã€‚ã“ã‚Œã¯10å€‹ä»¥ä¸Šã®çŠ¶æ…‹ãŒã‚ã‚Šã¾ã™
ChatGPT:
ãªã‚‹ã»ã©ï¼ã€ŒDocStatusã€ã¾ã§å…¥ã£ã¦ãã‚‹ã¨ã€ä¸€æ°—ã«æ¡ä»¶ã®çµ„ã¿åˆã‚ã›ãŒçˆ†ç™ºã—ã¾ã™ã­ ğŸš€
æ•´ç†ã—ã¦ã„ãã¨ãã¯ ã€Œãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ã€ï¼‹ã€Œæ¡ä»¶ã”ã¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã€ ã®è€ƒãˆæ–¹ã‚’ã•ã‚‰ã«æ‹¡å¼µã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚

ğŸ—‚ æ¡ä»¶ä¸€è¦§ï¼ˆç¾çŠ¶ï¼‰
docModeï¼ˆè¡¨ç¤º/ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼‰

constrTypeï¼ˆå·¥äº‹ç¨®åˆ¥ï¼‰

submissionTypeï¼ˆæå‡ºç¨®åˆ¥ï¼‰

freeInputï¼ˆãƒ•ãƒªãƒ¼å…¥åŠ›å¯å¦ï¼‰

docStatusï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆçŠ¶æ…‹ â† æ–°è¦ï¼‰

è¨­è¨ˆæ–¹é‡
åŸºæœ¬ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆdocMode Ã— Fieldï¼‰

ã“ã“ã§ã€Œæœ€ä½é™ã®å¯è¦–æ€§ãƒ»ç·¨é›†å¯å¦ã€ã‚’å®šç¾©ã™ã‚‹

æ¡ä»¶ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼ˆconstrType, submissionType, freeInput, docStatusï¼‰

å€‹åˆ¥ã®æ¡ä»¶ã‚’é–¢æ•°ã§é †ç•ªã«é©ç”¨ã™ã‚‹

è¿½åŠ ã®æ¡ä»¶ãŒå‡ºã¦ã‚‚é–¢æ•°ã‚’è¶³ã™ã ã‘

ãƒ«ãƒ¼ãƒ«é©ç”¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åŒ–
// types.ts
import { DecisionField } from "./fields";
import { DocMode } from "./modes";

export type FieldRule = {
  visible: boolean;
  editable: boolean;
};

export type RuleContext = {
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
  docStatus: string; // 10å€‹ä»¥ä¸Šã®çŠ¶æ…‹
};

// ãƒ«ãƒ¼ãƒ«é©ç”¨é–¢æ•°ã®å‹
export type RuleApplier = (field: DecisionField, base: FieldRule, ctx: RuleContext) => FieldRule;
æ¡ä»¶ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰é–¢æ•°
// ruleAppliers.ts
import { DecisionField } from "./fields";
import type { RuleApplier } from "./types";

// freeInput ã®ãƒ«ãƒ¼ãƒ«
export const applyFreeInput: RuleApplier = (field, base, ctx) => {
  if (field === DecisionField.DocSubject && !ctx.freeInput) {
    return { ...base, editable: false };
  }
  return base;
};

// submissionType ã®ãƒ«ãƒ¼ãƒ«
export const applySubmissionType: RuleApplier = (field, base, ctx) => {
  if (field === DecisionField.PrimaryFlg && ctx.submissionType === "draft") {
    return { ...base, visible: false };
  }
  return base;
};

// constrType ã®ãƒ«ãƒ¼ãƒ«
export const applyConstrType: RuleApplier = (field, base, ctx) => {
  if (field === DecisionField.DocType && ctx.constrType === "X") {
    return { ...base, editable: false };
  }
  return base;
};

// docStatus ã®ãƒ«ãƒ¼ãƒ«
export const applyDocStatus: RuleApplier = (field, base, ctx) => {
  // ä¾‹: "approved" ã®ã¨ãã¯å…¨é …ç›®ç·¨é›†ä¸å¯
  if (ctx.docStatus === "approved") {
    return { ...base, editable: false };
  }

  // ä¾‹: "archived" ã®ã¨ãã¯ DocSubject éè¡¨ç¤º
  if (ctx.docStatus === "archived" && field === DecisionField.DocSubject) {
    return { ...base, visible: false };
  }

  return base;
};
ãƒ«ãƒ¼ãƒ«é©ç”¨å‡¦ç†
// useFieldControl.ts
import { computed } from "vue";
import { baseRules } from "@/config/baseRules";
import { DecisionField } from "@/config/fields";
import type { RuleContext, FieldRule, RuleApplier } from "@/config/types";
import {
  applyFreeInput,
  applySubmissionType,
  applyConstrType,
  applyDocStatus,
} from "@/config/ruleAppliers";

// é©ç”¨é–¢æ•°ã‚’é †ç•ªã«ä¸¦ã¹ã‚‹
const appliers: RuleApplier[] = [
  applyFreeInput,
  applySubmissionType,
  applyConstrType,
  applyDocStatus,
];

export function useFieldControl(ctx: RuleContext) {
  const getRule = (field: DecisionField) =>
    computed<FieldRule>(() => {
      let rule = { ...baseRules[ctx.docMode][field] };

      // appliers ã‚’é †ç•ªã«é©ç”¨
      for (const apply of appliers) {
        rule = apply(field, rule, ctx);
      }

      return rule;
    });

  return { getRule };
}
ãƒ¡ãƒªãƒƒãƒˆ
DocStatus ãŒ10å€‹ä»¥ä¸Šã‚ã£ã¦ã‚‚å¤§ä¸ˆå¤«
â†’ applyDocStatus ã®ä¸­ã« switch (ctx.docStatus) ã‚’æ›¸ã‘ã°æ•´ç†ã§ãã‚‹

æ¡ä»¶ãŒå¢—ãˆã¦ã‚‚é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã ã‘
â†’ æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å£Šã•ãšã«æ‹¡å¼µå¯èƒ½

ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ã„
â†’ applyDocStatus(field, base, { docStatus: "approved", ... }) ã®ã‚ˆã†ã«å˜ä½“ãƒ†ã‚¹ãƒˆå¯èƒ½

ã“ã“ã§è³ªå•ãªã®ã§ã™ãŒã€
ğŸ“Œ docStatus ã® 10å€‹ä»¥ä¸Šã®çŠ¶æ…‹ã£ã¦ã€Œãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çš„ãªé€²è¡ŒçŠ¶æ…‹ã€ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ï¼ˆä¾‹: draft, submitted, approved, rejected, archived...ï¼‰

ã‚‚ã—ãã†ãªã‚‰ã€çŠ¶æ…‹é·ç§»ã®å›³ã‚’ãƒ™ãƒ¼ã‚¹ã«ã¾ã¨ã‚ãŸæ–¹ãŒæ•´ç†ã—ã‚„ã™ã„ã¨æ€ã†ã®ã§ã™ãŒã€çŠ¶æ…‹ä¸€è¦§ã‚’å‡ºã—ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ã™ã¹ã¦ã®æ¡ä»¶ã‚’å…ƒã«ã€decisionFieldã®ã‚­ãƒ¼ã«å¯¾ã™ã‚‹å€¤ã‚’è¨­å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã‹
ChatGPT:
ã§ãã¾ã™ ğŸ‘
ã¤ã¾ã‚Šã€Œã™ã¹ã¦ã®æ¡ä»¶ï¼ˆdocMode / constrType / submissionType / freeInput / docStatusï¼‰ã‚’ä¸€åº¦ã«è€ƒæ…®ã—ã¦ã€å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® visible / editable ã‚’æœ€çµ‚æ±ºå®šã™ã‚‹ã€ã¨ã„ã†å½¢ã§ã™ã­ã€‚

ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆdocMode Ã— fieldï¼‰ã‚’å®šç¾©ã—ã¦ãŠã

ã“ã‚Œã¯ã€Œæœ€ä½é™ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹ã€

æ¡ä»¶è©•ä¾¡é–¢æ•°ã‚’åˆæˆã—ã¦ã€æœ€çµ‚ãƒ«ãƒ¼ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

Record<DecisionField, FieldRule> ã‚’ã¾ã‚‹ã”ã¨è¿”ã™

Vue ãªã‚‰ computed ã«ã—ã¦ãŠã‘ã°ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«è¿½å¾“å¯èƒ½

å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸
// types.ts
import { DecisionField } from "./fields";
import { DocMode } from "./modes";

export type FieldRule = {
  visible: boolean;
  editable: boolean;
};

export type RuleContext = {
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
  docStatus: string;
};

export type FieldRules = Record<DecisionField, FieldRule>;
ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«
// baseRules.ts
import { DecisionField } from "./fields";
import { DocMode } from "./modes";
import type { FieldRules } from "./types";

export const baseRules: Record<DocMode, FieldRules> = {
  [DocMode.Create]: {
    [DecisionField.DocType]: { visible: true, editable: true },
    [DecisionField.DocName]: { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: true },
  },
  [DocMode.Edit]: {
    [DecisionField.DocType]: { visible: true, editable: false },
    [DecisionField.DocName]: { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: true },
  },
  [DocMode.EditAfterProposal]: { /* ...çœç•¥ */ } as FieldRules,
  [DocMode.View]: {
    [DecisionField.DocType]: { visible: true, editable: false },
    [DecisionField.DocName]: { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: true, editable: false },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  },
};
ãƒ«ãƒ¼ãƒ«åˆæˆå‡¦ç†
// useFieldRules.ts
import { computed } from "vue";
import { baseRules } from "./baseRules";
import { DecisionField } from "./fields";
import type { RuleContext, FieldRules } from "./types";

export function useFieldRules(ctx: RuleContext) {
  const rules = computed<FieldRules>(() => {
    // ã¾ãš baseRules ã‚’ã‚³ãƒ”ãƒ¼
    const result: FieldRules = { ...baseRules[ctx.docMode] };

    // freeInput ã®åæ˜ 
    if (!ctx.freeInput) {
      result[DecisionField.DocSubject] = {
        ...result[DecisionField.DocSubject],
        editable: false,
      };
    }

    // submissionType ã®åæ˜ 
    if (ctx.submissionType === "draft") {
      result[DecisionField.PrimaryFlg] = {
        ...result[DecisionField.PrimaryFlg],
        visible: false,
      };
    }

    // constrType ã®åæ˜ 
    if (ctx.constrType === "X") {
      result[DecisionField.DocType] = {
        ...result[DecisionField.DocType],
        editable: false,
      };
    }

    // docStatus ã®åæ˜ 
    switch (ctx.docStatus) {
      case "approved":
        // å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç·¨é›†ä¸å¯
        for (const key of Object.values(DecisionField)) {
          result[key as DecisionField] = { ...result[key as DecisionField], editable: false };
        }
        break;

      case "archived":
        result[DecisionField.DocSubject] = {
          ...result[DecisionField.DocSubject],
          visible: false,
        };
        break;
    }

    return result;
  });

  return { rules };
}
åˆ©ç”¨ä¾‹
<script setup lang="ts">
import { DecisionField } from "@/config/fields";
import { DocMode } from "@/config/modes";
import { useFieldRules } from "@/config/useFieldRules";

const ctx = reactive({
  docMode: DocMode.Edit,
  constrType: "X",
  submissionType: "draft",
  freeInput: false,
  docStatus: "approved",
});

const { rules } = useFieldRules(ctx);
</script>

<template>
  <v-text-field
    v-if="rules[DecisionField.DocName].visible"
    v-model="form.value.docName"
    label="Document Name"
    :disabled="!rules[DecisionField.DocName].editable"
  />
</template>
âœ… ã“ã®æ–¹æ³•ãªã‚‰ã€Œã™ã¹ã¦ã®æ¡ä»¶ã‚’ä¸€åº¦ã«è€ƒæ…®ã—ã¦ã€DecisionField ã”ã¨ã®æœ€çµ‚çŠ¶æ…‹ã‚’ä¸€æ‹¬ã§ä½œã‚Œã‚‹ã€ã®ã§ã€ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ã»ã¼ãã®ã¾ã¾ã‚³ãƒ¼ãƒ‰åŒ–ã§ãã¾ã™ã€‚

è³ªå•ã§ã™ï¼š
ğŸ‘‰ Excel ã®ãƒãƒˆãƒªã‚¯ã‚¹ã£ã¦ã€Œæœ€çµ‚å½¢ï¼ˆã™ã¹ã¦ã®æ¡ä»¶ã‚’åæ˜ æ¸ˆã¿ã®è¡¨ç¤º/ç·¨é›†çŠ¶æ…‹ï¼‰ã€ãŒæ›¸ã„ã¦ã‚ã‚‹æ„Ÿã˜ã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€ŒdocMode Ã— field ã®ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ã€ã ã‘ãŒã‚ã£ã¦ã€ä»–æ¡ä»¶ã¯è£œè¶³ã§æ›¸ã„ã¦ã‚ã‚‹æ„Ÿã˜ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ã„ã‚„ã€æ¡ä»¶é–¢æ•°ã‚’ä½¿ã†ã®ã§ã¯ãªãã€ä¸€ç™ºã§ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼ã§ã§ãã¾ã›ã‚“ã‹ã€‚objectã˜ã‚ƒãªãã¦mapã§ã‚‚ã„ã„ã§ã™
ChatGPT:
ãªã‚‹ã»ã©ï¼
ã€Œé–¢æ•°ã‚’ç©ã¿é‡ã­ã¦æ¡ä»¶åˆ¤å®šã™ã‚‹ã€ã®ã§ã¯ãªãã¦ã€ä¸€ç™ºã§ DecisionField ã”ã¨ã®æœ€çµ‚çŠ¶æ…‹ã‚’ Map ã‚„ Object ã§æŒã¡ãŸã„ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚

ã¤ã¾ã‚Šã“ã†ã„ã†å½¢ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã€ã¨ã„ã†ç†è§£ã§åˆã£ã¦ã¾ã™ã‹ï¼Ÿ

// Map ã‚’ä½¿ã£ãŸä¾‹
const rules = new Map<
  DecisionField,
  { visible: boolean; editable: boolean }
>([
  [DecisionField.DocType, { visible: true, editable: false }],
  [DecisionField.DocName, { visible: true, editable: true }],
  [DecisionField.DocSubject, { visible: false, editable: false }],
  [DecisionField.CreatedAt, { visible: true, editable: false }],
  [DecisionField.PrimaryFlg, { visible: true, editable: true }],
]);
ã©ã†ã‚„ã£ã¦ä¸€ç™ºã§æ±ºã‚ã‚‹ã‹ï¼Ÿ
ã“ã‚Œã¯ã€Œè¤‡æ•°ã®æ¡ä»¶ã‚’ã‚­ãƒ¼ã«ã—ãŸè¾æ›¸ã€ã‚’æŒã£ã¦ãŠã‘ã°å¯èƒ½ã§ã™ã€‚
ã¤ã¾ã‚Š (docMode, constrType, submissionType, freeInput, docStatus) ã®çµ„ã¿åˆã‚ã›ã‚’ã‚­ãƒ¼ã«ã—ã¦ã€ãã®ã¨ãã®å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’å€¤ã«ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

ä¾‹: ãƒ«ãƒ¼ãƒ«å®šç¾©ï¼ˆMap ç‰ˆï¼‰
import { DecisionField } from "./fields";
import { DocMode } from "./modes";
import type { FieldRules } from "./types";

// ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚­ãƒ¼ã‚’æ–‡å­—åˆ—åŒ–ã—ã¦æ‰±ã†
function ctxKey(
  docMode: DocMode,
  constrType: string,
  submissionType: string,
  freeInput: boolean,
  docStatus: string
) {
  return `${docMode}|${constrType}|${submissionType}|${freeInput}|${docStatus}`;
}

// ãƒ«ãƒ¼ãƒ«è¾æ›¸
const ruleMatrix = new Map<string, FieldRules>();

// ä¾‹: Create Ã— constrType=A Ã— submissionType=draft Ã— freeInput=true Ã— status=draft
ruleMatrix.set(
  ctxKey(DocMode.Create, "A", "draft", true, "draft"),
  {
    [DecisionField.DocType]: { visible: true, editable: true },
    [DecisionField.DocName]: { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  }
);

// ä¾‹: View Ã— constrType=B Ã— submissionType=final Ã— freeInput=false Ã— status=approved
ruleMatrix.set(
  ctxKey(DocMode.View, "B", "final", false, "approved"),
  {
    [DecisionField.DocType]: { visible: true, editable: false },
    [DecisionField.DocName]: { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: false, editable: false },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: false, editable: false },
  }
);
åˆ©ç”¨å´
function getFieldRules(ctx: {
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
  docStatus: string;
}): FieldRules | undefined {
  return ruleMatrix.get(
    ctxKey(
      ctx.docMode,
      ctx.constrType,
      ctx.submissionType,
      ctx.freeInput,
      ctx.docStatus
    )
  );
}

// ä½¿ã†ã¨ã
const rules = getFieldRules({
  docMode: DocMode.View,
  constrType: "B",
  submissionType: "final",
  freeInput: false,
  docStatus: "approved",
});

if (rules) {
  console.log(rules[DecisionField.DocName].editable); // false
}
ãƒ¡ãƒªãƒƒãƒˆ
ä¸€ç™ºã§ O(1) ã§å¼•ã‘ã‚‹

Excel ã®ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ãã®ã¾ã¾ãƒ‡ãƒ¼ã‚¿åŒ–ã§ãã‚‹

ã€Œé–¢æ•°ã®ç©ã¿é‡ã­ã€ä¸è¦ã§ã‚·ãƒ³ãƒ—ãƒ«

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
çµ„ã¿åˆã‚ã›çˆ†ç™ºï¼šæ¡ä»¶ãŒå¤šã„ã¨ãƒ«ãƒ¼ãƒ«è¡¨ã®æ•°ãŒè†¨å¤§ã«ãªã‚‹

å…¨ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¶²ç¾…ã™ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡¦ç†ã‚’ã©ã†ã™ã‚‹ã‹è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚‹

âœ… ã¾ã¨ã‚

ã€Œã™ã¹ã¦ã®æ¡ä»¶ã‚’ã‚­ãƒ¼ã«ã—ã¦ Map ã«ä¿æŒã™ã‚‹ã€æ–¹å¼ãªã‚‰ã€ä¸€ç™ºã§æœ€çµ‚çš„ãªãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã‚‰ã‚Œã¾ã™ã€‚

ãŸã ã—æ¡ä»¶çµ„ã¿åˆã‚ã›ãŒå¤šã„å ´åˆã€Excel ã‚’ãã®ã¾ã¾ JSON/TS åŒ–ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã‚Šã¾ã™ã€‚

è³ªå•ã§ã™ãŒï¼š
ğŸ‘‰ Excel ã®ãƒãƒˆãƒªã‚¯ã‚¹ã£ã¦ã€Œå…¨çµ„ã¿åˆã‚ã›ã‚’ç¶²ç¾…ã—ã¦ã„ã‚‹è¡¨ã€ãªã‚“ã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€ŒåŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‹ä¾‹å¤–æ¡ä»¶ã€ã¿ãŸã„ã«æ›¸ã‹ã‚Œã¦ã¾ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã‹ç‰¹ã«ãªãã¦ã€ãã‚Œãã‚Œå€‹åˆ¥ã«è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€baseãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã‹å®šç¾©ã—ã¥ã‚‰ã„æ„Ÿã˜ã®ãƒ‡ãƒ¼ã‚¿ã§ã™
ChatGPT:
ãªã‚‹ã»ã©ï¼ç†è§£ã—ã¾ã—ãŸã€‚
ã¤ã¾ã‚Š ã€Œbaseãƒ«ãƒ¼ãƒ«ï¼‹ä¾‹å¤–ã€ã¿ãŸã„ãªæ•´ç†ã¯ã§ããªãã¦ã€Excelã«æ›¸ã„ã¦ã‚ã‚‹1è¡Œ1è¡ŒãŒå”¯ä¸€ã®æ­£è§£ãƒ«ãƒ¼ãƒ«ã€ ã£ã¦æ„Ÿã˜ã§ã™ã­ã€‚

ãã†ã„ã†å ´åˆã¯ã¾ã•ã« å…¨æ¡ä»¶çµ„ã¿åˆã‚ã›ã‚’ã‚­ãƒ¼ã«ã—ã¦ã€æœ€çµ‚ãƒ«ãƒ¼ãƒ«ã‚’Mapã‚„Objectã§ç›´æ¥ç®¡ç†ã™ã‚‹ ã®ãŒãƒ™ã‚¹ãƒˆã§ã™ ğŸ‘

å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸
1. æ¡ä»¶ã‚’æ–‡å­—åˆ—ã‚­ãƒ¼ã«å¤‰æ›ã™ã‚‹é–¢æ•°
function ctxKey(
  docMode: DocMode,
  constrType: string,
  submissionType: string,
  freeInput: boolean,
  docStatus: string
) {
  return `${docMode}|${constrType}|${submissionType}|${freeInput}|${docStatus}`;
}
2. ãƒ«ãƒ¼ãƒ«å®šç¾©ï¼ˆExcelã‹ã‚‰ãã®ã¾ã¾ç§»ã™ï¼‰
const ruleMatrix = new Map<string, FieldRules>();

ruleMatrix.set(
  ctxKey(DocMode.Create, "A", "draft", true, "draft"),
  {
    [DecisionField.DocType]: { visible: true, editable: true },
    [DecisionField.DocName]: { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  }
);

ruleMatrix.set(
  ctxKey(DocMode.View, "B", "final", false, "approved"),
  {
    [DecisionField.DocType]: { visible: true, editable: false },
    [DecisionField.DocName]: { visible: true, editable: false },
    [DecisionField.DocSubject]: { visible: false, editable: false },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: false, editable: false },
  }
);

// ...Excelã®è¡Œæ•°åˆ†ã ã‘ ruleMatrix.set(...) ã‚’ä¸¦ã¹ã‚‹
3. åˆ©ç”¨å´
function getFieldRules(ctx: {
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
  docStatus: string;
}): FieldRules | undefined {
  return ruleMatrix.get(
    ctxKey(
      ctx.docMode,
      ctx.constrType,
      ctx.submissionType,
      ctx.freeInput,
      ctx.docStatus
    )
  );
}
ãƒ¡ãƒªãƒƒãƒˆ
Excelã®è¡¨ã‚’ãã®ã¾ã¾ãƒ—ãƒ­ã‚°ãƒ©ãƒ åŒ–ã§ãã‚‹

ä¸€ç™ºã§æœ€çµ‚ãƒ«ãƒ¼ãƒ«ãŒå¼•ã‘ã‚‹ï¼ˆO(1)ï¼‰

ã€Œæ¡ä»¶é–¢æ•°ã€ã‚„ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«ã€ã®æ€è€ƒã‚’æŒŸã¾ãšã«æ¸ˆã‚€

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
Excelã®è¡ŒãŒå¤šã‘ã‚Œã°ã€ãã®ã¾ã¾ã‚³ãƒ¼ãƒ‰ã‚‚å¤§ãããªã‚‹

æ–°ã—ã„æ¡ä»¶ãŒå¢—ãˆã‚‹ã¨å…¨çµ„ã¿åˆã‚ã›ã‚’è¿½åŠ ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„

âœ… ã¾ã¨ã‚
ä»Šå›ã®ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãªã—ãƒ»å…¨éƒ¨å€‹åˆ¥ã«è€ƒæ…®ã€ã¨ã„ã†è¦ä»¶ãªã‚‰ã€
ğŸ‘‰ Mapã‚„Objectã«ã€Œã‚­ãƒ¼=æ¡ä»¶ã‚»ãƒƒãƒˆã€ã€Œå€¤=ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ«ãƒ¼ãƒ«å…¨ä½“ã€ã‚’ãã®ã¾ã¾æŒã¤æ–¹å¼ ãŒä¸€ç•ªç´ ç›´ã§ãƒã‚°ã‚‚å°‘ãªã„ã§ã™ã€‚

è³ªå•ãªã®ã§ã™ãŒï¼š
ğŸ“Œ Excelã®è¡Œæ•°ã¯ã–ã£ãã‚Šã©ã‚Œãã‚‰ã„ã‚ã‚Šã¾ã™ã‹ï¼Ÿï¼ˆæ•°åè¡Œï¼Ÿæ•°ç™¾è¡Œï¼Ÿï¼‰
â†’ è¡Œæ•°ãŒå¤šã„å ´åˆã¯ã€Excelã‚’ãã®ã¾ã¾JSONã«å¤‰æ›ã—ã¦ ruleMatrix ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã£ãŸã»ã†ãŒã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚ãªãŸ:
ctxKeyã£ã¦æ–‡å­—åˆ—ã«ã™ã‚‹å¿…è¦ã‚ã‚Šã¾ã™ã‹ã€‚
ChatGPT:
ã„ã„ã¨ã“ã‚ã«æ°—ã¥ãã¾ã—ãŸã­ ğŸ‘Œ
å¿…ãšã—ã‚‚æ–‡å­—åˆ—åŒ–ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

é¸æŠè‚¢
â‘  æ–‡å­—åˆ—ã‚­ãƒ¼ï¼ˆä»Šèª¬æ˜ã—ãŸæ–¹æ³•ï¼‰
å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«

JSON ã«ã‚‚ãã®ã¾ã¾ã—ã‚„ã™ã„

ãŸã ã—ã‚­ãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–“é•ã„ã«å¼±ã„ï¼ˆtypo ã‚„ "true" vs trueï¼‰

â‘¡ è¤‡åˆã‚­ãƒ¼ã‚’ãã®ã¾ã¾ä½¿ã†
TypeScript / JavaScript ã® Map ã¯ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„ã‚¿ãƒ—ãƒ«ãã®ã‚‚ã®ã€ã‚’ã‚­ãƒ¼ã«ã§ãã¾ã™ã€‚

type CtxKey = [DocMode, string, string, boolean, string];

const ruleMatrix = new Map<CtxKey, FieldRules>();

// å®šç¾©
ruleMatrix.set(
  [DocMode.Create, "A", "draft", true, "draft"],
  {
    [DecisionField.DocType]: { visible: true, editable: true },
    [DecisionField.DocName]: { visible: true, editable: true },
    [DecisionField.DocSubject]: { visible: true, editable: true },
    [DecisionField.CreatedAt]: { visible: true, editable: false },
    [DecisionField.PrimaryFlg]: { visible: true, editable: false },
  }
);

// åˆ©ç”¨
const rules = ruleMatrix.get([
  DocMode.Create,
  "A",
  "draft",
  true,
  "draft",
]); // âŒ undefined
âš ï¸ æ³¨æ„ç‚¹ï¼š
é…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚­ãƒ¼ã«ã—ãŸå ´åˆã€å‚ç…§ãŒåŒã˜ã§ãªã„ã¨ä¸€è‡´ã—ã¾ã›ã‚“ã€‚
ã¤ã¾ã‚Šã€[DocMode.Create, "A", "draft", true, "draft"] ã‚’ set ã—ãŸå¾Œã€åŒã˜å†…å®¹ã®åˆ¥é…åˆ—ã‚’ get ã«ä½¿ã†ã¨ä¸€è‡´ã—ã¾ã›ã‚“ã€‚

â†’ ãªã®ã§ã“ã®æ–¹æ³•ã¯ã€ŒctxKeyé–¢æ•°ã‚’é€šã˜ã¦å¸¸ã«åŒã˜å‚ç…§ã‚’ä½¿ã†ã€ä»•çµ„ã¿ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

â‘¢ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚­ãƒ¼ã«ã™ã‚‹
type CtxKeyObj = {
  docMode: DocMode;
  constrType: string;
  submissionType: string;
  freeInput: boolean;
  docStatus: string;
};

const ruleMatrix = new Map<CtxKeyObj, FieldRules>();

const key: CtxKeyObj = {
  docMode: DocMode.Create,
  constrType: "A",
  submissionType: "draft",
  freeInput: true,
  docStatus: "draft",
};

ruleMatrix.set(key, { ... });
ruleMatrix.get(key); // âœ… ã“ã‚Œã¯å–ã‚Œã‚‹
âš ï¸ ã“ã‚Œã‚‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‚ç…§ãŒåŒã˜ã§ãªã„ã¨ãƒ’ãƒƒãƒˆã—ãªã„ã®ã§ã€çµå±€ã€Œä¸€ç™ºã§ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã€ãŒå¿…è¦ã€‚

â‘£ å®‰å…¨ï¼†å®Ÿç”¨çš„ãªã®ã¯ã€Œæ–‡å­—åˆ—åŒ–ã€
å‚ç…§å•é¡Œã‚’é¿ã‘ã‚‹ãŸã‚ã«ã¯ã€ŒctxKeyé–¢æ•°ã§ä¸€è²«ã—ã¦æ–‡å­—åˆ—åŒ–ã—ã¦ä½¿ã†ã€ã®ãŒä¸€ç•ªæ‰±ã„ã‚„ã™ã„ã§ã™ã€‚
Excel ã‚„ JSON ã«ã‚‚ãã®ã¾ã¾è½ã¨ã—è¾¼ã‚ã¾ã™ã—ã€‚

çµè«–
å°è¦æ¨¡ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ã«ç®¡ç†ã™ã‚‹ãªã‚‰æ–‡å­—åˆ—ã‚­ãƒ¼ãŒãƒ™ã‚¹ãƒˆ

å‹å®‰å…¨æ€§ã‚’é«˜ã‚ãŸã„ãªã‚‰ç‹¬è‡ªã® enum / union å‹ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚­ãƒ¼ã‚’ string ã«ã—ã¦ã‚‚å•é¡Œãªã—

ã‚‚ã—ã©ã†ã—ã¦ã‚‚ Map ã®ã‚¿ãƒ—ãƒ«ã‚­ãƒ¼ã‚’ä½¿ã„ãŸã„ãªã‚‰ â†’ å‚ç…§ã‚’çµ±ä¸€ã™ã‚‹ä»•çµ„ã¿ï¼ˆä¾‹: const allKeys = { ... } ã«äº‹å‰å®šç¾©ã—ã¦ãã“ã‹ã‚‰å‚ç…§ï¼‰ã‚’å¿…ãšç”¨æ„ã™ã‚‹

ğŸ‘‰ è³ªå•ã§ã™ï¼š
Excel ã®ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ã€Œãã®ã¾ã¾JSON/TSã«å¤‰æ›ã—ã¦èª­ã¿è¾¼ã‚€ã€æƒ³å®šã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€Œã‚³ãƒ¼ãƒ‰ã«ç›´æ¥æ›¸ãè¾¼ã‚“ã§ç®¡ç†ã€ã™ã‚‹æ„Ÿã˜ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
[DocMode.Create, "A", "draft", true, "draft"]ã®ã‚ˆã†ãªéƒ¨åˆ†ã‚’ã‚­ãƒ¼ã«ã™ã‚‹ä»£ã‚ã‚Šã«ã€mapã®ã‚­ãƒ¼ã¯decisionFiledã«ã—ã¦ã€å€¤ã®æ–¹ã‚’[DocMode.Create, "A", "draft", true, "draft"],ã¨ã‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ—æŒ™ã™ã‚‹å½¢å¼ã«ã¯å‡ºãã¾ã›ã‚“ã‹
ChatGPT:
ãªã‚‹ã»ã© ğŸ‘
ã¤ã¾ã‚Šã€Œæ¡ä»¶ï¼ˆdocMode, constrType, â€¦, docStatusï¼‰ã€ã‚’ã‚­ãƒ¼ã«ã™ã‚‹ã®ã§ã¯ãªãã€DecisionField ã‚’ã‚­ãƒ¼ã«ã—ã¦ã€ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã©ã®æ¡ä»¶ã§ editable / visible ã«ãªã‚‹ã‹ã‚’åˆ—æŒ™ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã­ã€‚

ã§ãã¾ã™ã‚ˆã€‚å½¢å¼ã¨ã—ã¦ã¯ã€ä¾‹ãˆã° Map<DecisionField, Rule[]> ã«ã—ã¦ã€ãã‚Œãã‚Œã® DecisionField ã”ã¨ã«ãƒ«ãƒ¼ãƒ«ã‚’åˆ—æŒ™ã™ã‚‹æ–¹å¼ã§ã™ã€‚

import { DecisionField, DocMode } from '~/composables/tmp'

type Context = {
  docMode: DocMode
  constrType: string
  submissionType: string
  freeInput: boolean
  docStatus: string
}

type Rule = {
  when: Partial<Context> // æ¡ä»¶
  editable: boolean
  visible: boolean
}

const fieldRules = new Map<DecisionField, Rule[]>([
  [
    DecisionField.DocName,
    [
      {
        when: { docMode: DocMode.Create, docStatus: "draft" },
        editable: true,
        visible: true,
      },
      {
        when: { docMode: DocMode.View },
        editable: false,
        visible: true,
      },
    ],
  ],
  [
    DecisionField.DocType,
    [
      {
        when: { docMode: DocMode.Edit, constrType: "A" },
        editable: false,
        visible: true,
      },
    ],
  ],
  [
    DecisionField.CreatedAt,
    [
      {
        when: { docMode: DocMode.Create },
        editable: false,
        visible: false,
      },
      {
        when: { docMode: DocMode.View },
        editable: false,
        visible: true,
      },
    ],
  ],
])
æ¬¡ã«ã€Œä»Šã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ãŠã‘ã‚‹çŠ¶æ…‹ã€ã‚’å–ã‚Šå‡ºã™ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½œã‚Šã¾ã™ã€‚

function getFieldState(
  field: DecisionField,
  ctx: Context
): { editable: boolean; visible: boolean } {
  const rules = fieldRules.get(field) ?? []
  for (const rule of rules) {
    const matched = Object.entries(rule.when).every(
      ([k, v]) => (ctx as any)[k] === v
    )
    if (matched) {
      return { editable: rule.editable, visible: rule.visible }
    }
  }
  // ãƒãƒƒãƒã—ãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  return { editable: false, visible: false }
}
åˆ©ç”¨ä¾‹:

const ctx: Context = {
  docMode: DocMode.Create,
  constrType: "A",
  submissionType: "draft",
  freeInput: true,
  docStatus: "draft",
}

const state = getFieldState(DecisionField.DocName, ctx)
// -> { editable: true, visible: true }
ã“ã®æ–¹å¼ãªã‚‰

ã‚­ãƒ¼ãŒ DecisionField å›ºå®š

å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«è¤‡æ•°ã®ãƒ«ãƒ¼ãƒ«ã‚’åˆ—æŒ™ã§ãã‚‹

æ¡ä»¶ã¯ when ã§éƒ¨åˆ†çš„ã«æŒ‡å®šã™ã‚Œã°ã‚ˆã„

ã¨ã„ã†æ„Ÿã˜ã§ã€ã€ŒExcelã®ãƒãƒˆãƒªã‚¯ã‚¹ã‚’è¡Œã”ã¨ã«å¤‰æ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã€ã‚’ãã®ã¾ã¾è²¼ã‚Œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã‚Šã¾ã™ã€‚

ğŸ‘‰ ã”è³ªå•ï¼š
ã“ã®ãƒ«ãƒ¼ãƒ«å®šç¾©ã‚’ã€ŒTypeScriptã®ã‚³ãƒ¼ãƒ‰ã«ãƒ™ã‚¿æ›¸ãã€ã™ã‚‹æƒ³å®šã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€ŒJSONã«ã¾ã¨ã‚ã¦å¤–éƒ¨ã‹ã‚‰èª­ã¿è¾¼ã¿ãŸã„ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ã‚­ãƒ¼ãŒ DecisionField å›ºå®šã€ã¨ã€ã‚­ãƒ¼ãŒè‰²ã€…ãªçŠ¶æ…‹ã€ã¨ã©ã£ã¡ãŒã„ã„ã¨æ€ã„ã¾ã™ã‹
ChatGPT:
è‰¯ã„è³ªå•ã§ã™ã­ ğŸ‘Œ
å®Ÿå‹™ã§ã€Œã©ã£ã¡ã®å½¢ã§ãƒ«ãƒ¼ãƒ«ã‚’æŒã¤ã‹ã€ã¯ã€ç®¡ç†ã®ã—ã‚„ã™ã• ã¨ å–ã‚Šå‡ºã™ã¨ãã®ä½¿ã„ã‚„ã™ã• ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã«ãªã‚Šã¾ã™ã€‚

1. ã‚­ãƒ¼ãŒ DecisionField å›ºå®š
Map<DecisionField, Rule[]>
ãƒ¡ãƒªãƒƒãƒˆ
ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«ãƒ«ãƒ¼ãƒ«ãŒã¾ã¨ã¾ã‚‹ã®ã§è¦‹é€šã—ãŒã„ã„
â†’ Excelã®ã€Œåˆ—ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã€ã”ã¨ã«æ¡ä»¶ã‚’ã¾ã¨ã‚ãŸå½¢ã«è¿‘ã„

ãƒ«ãƒ¼ãƒ«ã‚’æ¢ã™ã¨ãã«ã€ŒDocNameã®ãƒ«ãƒ¼ãƒ«ã¯ã“ã“ï¼ã€ã¨ã™ãè¦‹ã¤ã‘ã‚‰ã‚Œã‚‹

ã€Œã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ã‘æŠœãå‡ºã—ã¦è¡¨ç¤ºåˆ¶å¾¡ã—ãŸã„ã€å ´åˆã«ä¾¿åˆ©

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
ã€Œå…¨ä½“ã®ç‰¹å®šæ¡ä»¶ã§ã®æŒ¯ã‚‹èˆã„ã€ã‚’æ¨ªæ–­çš„ã«æ¢ã—ã«ãã„
ä¾‹: docMode = View ã®ã¨ãã« å…¨éƒ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ãŒã©ã†ãªã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã®ãŒå°‘ã—å¤§å¤‰

2. ã‚­ãƒ¼ãŒã€Œæ¡ä»¶ï¼ˆçŠ¶æ…‹ã‚»ãƒƒãƒˆï¼‰ã€å›ºå®š
Map<ContextKey, { [field in DecisionField]: { editable: boolean; visible: boolean } }>
ãƒ¡ãƒªãƒƒãƒˆ
ã€Œã“ã®çŠ¶æ…‹ï¼ˆdocMode=View, constrType=A, â€¦ï¼‰ã®ã¨ãã«å…¨éƒ¨ã©ã†ãªã‚‹ã‹ã€ãŒä¸€ç™ºã§åˆ†ã‹ã‚‹

Excelã®ã€Œè¡Œï¼ˆæ¡ä»¶ã‚»ãƒƒãƒˆï¼‰ã€ã‚’ãã®ã¾ã¾ãƒ‡ãƒ¼ã‚¿ã«è½ã¨ã—è¾¼ã‚ã‚‹

å®Ÿè¡Œæ™‚ã¯ lookup ãŒ O(1)ï¼ˆMapã®ã‚­ãƒ¼ä¸€è‡´ã ã‘ï¼‰

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ãƒ»ä¿®æ­£ã™ã‚‹ã¨ãã«åˆ†ã‹ã‚Šã¥ã‚‰ã„

1ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹•ä½œã ã‘ç¢ºèªã—ãŸã„ã¨ãã«æ¢ã—ã«ãã„

å®Ÿå‹™çš„ãªãŠã™ã™ã‚
Excelã‚’ã€Œè¡Œï¼æ¡ä»¶ã‚»ãƒƒãƒˆã€ã€Œåˆ—ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã«ã—ã¦ã„ã‚‹ãªã‚‰ â†’ â‘¡ æ¡ä»¶ã‚­ãƒ¼æ–¹å¼ ãŒè‡ªç„¶

é–‹ç™ºè€…ãŒã€Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã§ä»•æ§˜ã‚’è¿½ã„ãŸã„ã€ã“ã¨ãŒå¤šã„ãªã‚‰ â†’ â‘  ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¼æ–¹å¼ ãŒç®¡ç†ã—ã‚„ã™ã„

ğŸ’¡ ã‚ˆãã‚ã‚‹å¦¥å”ç­–ï¼š

å†…éƒ¨ãƒ‡ãƒ¼ã‚¿ã¯ã€Œæ¡ä»¶ã‚­ãƒ¼æ–¹å¼ã€ï¼ˆExcelã®è¡¨ã‚’ãã®ã¾ã¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã‚„ã™ã„ï¼‰

ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã€Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ãƒ“ãƒ¥ãƒ¼ã€ã‚’ä½œã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã†ã™ã‚‹ã¨ã€Excelã®ãƒ«ãƒ¼ãƒ«ã‚’å¤‰æ›ã—ã¦çªã£è¾¼ã‚€ã®ã‚‚æ¥½ã ã—ã€ã‚³ãƒ¼ãƒ‰ä¸Šã§ã€Œã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ«ãƒ¼ãƒ«ã ã‘è¦‹ãŸã„ã€ã¨ãã‚‚å¯¾å¿œã§ãã¾ã™ã€‚

ğŸ‘‰ è³ªå•ï¼š
ä»Šã®ãƒ«ãƒ¼ãƒ«ç®¡ç†ã¯ã€ŒExcelã§ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ä½œã£ã¦ã€ãã‚Œã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚³ãƒ¼ãƒ‰ã¸åæ˜ ã€ã™ã‚‹é‹ç”¨ã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€Œæœ€åˆã¯Excelã§æ•´ç†ã™ã‚‹ã‘ã©ã€æœ€çµ‚çš„ã«ã¯ã‚³ãƒ¼ãƒ‰ã§å®Œçµã•ã›ã‚‹ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ã€Œæœ€åˆã¯Excelã§æ•´ç†ã™ã‚‹ã‘ã©ã€æœ€çµ‚çš„ã«ã¯ã‚³ãƒ¼ãƒ‰ã§å®Œçµã•ã›ã‚‹ã€ ã§ã™
ChatGPT:
ãªã‚‹ã»ã©ï¼äº†è§£ã§ã™ ğŸ‘

ãã®å ´åˆã€å®Ÿå‹™ä¸ŠãŠã™ã™ã‚ã®æ–¹æ³•ã¯ã“ã†ãªã‚Šã¾ã™ï¼š

ğŸ’¡ ãŠã™ã™ã‚è¨­è¨ˆ
Excelã¯æ¡ä»¶ã‚»ãƒƒãƒˆï¼ˆè¡Œï¼‰ãƒ™ãƒ¼ã‚¹ã§æ•´ç†

1è¡Œ = 1æ¡ä»¶ã‚»ãƒƒãƒˆï¼ˆdocMode, constrType, submissionType, freeInput, docStatusï¼‰

å„åˆ— = DecisionField

ã‚»ãƒ« = { visible, editable }

Excel â†’ JSON/TS ã«å¤‰æ›

Mapã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ä¿æŒ

å½¢å¼ä¾‹ï¼ˆæ¡ä»¶ã‚»ãƒƒãƒˆã‚­ãƒ¼æ–¹å¼ï¼‰ï¼š

type FieldRules = Record<DecisionField, { visible: boolean; editable: boolean }>

type RuleEntry = {
  ctx: {
    docMode: DocMode
    constrType: string
    submissionType: string
    freeInput: boolean
    docStatus: string
  }
  rules: FieldRules
}

// Excelã‹ã‚‰å¤‰æ›ã—ãŸJSON
const ruleMatrix: RuleEntry[] = [
  {
    ctx: { docMode: DocMode.Create, constrType: "A", submissionType: "draft", freeInput: true, docStatus: "draft" },
    rules: {
      [DecisionField.DocType]: { visible: true, editable: true },
      [DecisionField.DocName]: { visible: true, editable: true },
      [DecisionField.DocSubject]: { visible: true, editable: true },
      [DecisionField.CreatedAt]: { visible: true, editable: false },
      [DecisionField.PrimaryFlg]: { visible: true, editable: false },
    }
  },
  // Excelã®è¡Œã”ã¨ã«è¿½åŠ â€¦
]
ã‚³ãƒ¼ãƒ‰ä¸Šã§lookupé–¢æ•°ã‚’ç”¨æ„

function getRulesForContext(ctx: RuleEntry['ctx']): FieldRules | undefined {
  return ruleMatrix.find(entry =>
    Object.entries(ctx).every(([k, v]) => (entry.ctx as any)[k] === v)
  )?.rules
}
âœ… ãƒ¡ãƒªãƒƒãƒˆ
Excelã§æ•´ç† â†’ JSONã«å¤‰æ› â†’ ã‚³ãƒ¼ãƒ‰ã§å®Œçµ ã¨ã„ã†ãƒ•ãƒ­ãƒ¼ãŒè‡ªç„¶

ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ ãƒ»ä¿®æ­£ã¯Excelã§ç®¡ç†ã§ãã‚‹

TypeScriptã§å‹ãƒã‚§ãƒƒã‚¯å¯èƒ½

å…¨æ¡ä»¶ã‚»ãƒƒãƒˆã‚’ä¸€ç™ºã§å–å¾—ã§ãã‚‹

è£œè¶³
æ¡ä»¶ã‚»ãƒƒãƒˆãŒè†¨å¤§ã«ãªã‚‹å ´åˆã¯ã€Excel â†’ JSONè‡ªå‹•å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨æ„ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™

JSONåŒ–ã—ã¦ãŠã‘ã°ã€å°†æ¥çš„ã«Mapã«å¤‰æ›ã—ã¦O(1) lookupã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™

è³ªå•ã§ã™ï¼š
ğŸ’¡ ã“ã®æ–¹å¼ã§ä½œã‚‹å ´åˆã€Mapã«ã™ã‚‹ã‹é…åˆ—ã®ã¾ã¾ç·šå½¢æ¤œç´¢ã™ã‚‹ã‹ã¯æ°—ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ
ï¼ˆè¡Œæ•°ãŒæ•°ç™¾è¡Œãã‚‰ã„ãªã‚‰é…åˆ—ã§ã‚‚ååˆ†ã§ã™ï¼‰

ã‚ãªãŸ:
ctxã®å€¤ãŒpropsã‚„piniaã‚„apiã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ··åˆã—ã¦ã„ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹
ChatGPT:
ã¯ã„ã€å¤§ä¸ˆå¤«ã§ã™ ğŸ‘

ãƒã‚¤ãƒ³ãƒˆã¯ ã€Œæœ€çµ‚çš„ã«ãã®æ™‚ç‚¹ã®ã™ã¹ã¦ã®æ¡ä»¶å€¤ãŒæƒã£ã¦ã„ã‚‹ã“ã¨ã€ ã§ã™ã€‚

ç†ç”±
getRulesForContext(ctx) ã®ã‚ˆã†ãªé–¢æ•°ã¯ å˜ç´”ã« ctx ã®å€¤ã¨ãƒ«ãƒ¼ãƒ«ã®æ¡ä»¶ã‚’æ¯”è¼ƒã—ã¦ã„ã‚‹ã ã‘ ã§ã™

propsãƒ»Piniaãƒ»APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãªã©ã€å€¤ã®å–å¾—å…ƒã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“

ã€Œæ¯”è¼ƒã™ã‚‹å€¤ãŒãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ã©ã†ã‹ã€ ã‚‚é–¢æ•°å†…ã§ã¯å•é¡Œã«ãªã‚‰ãªã„

ãŸã ã—ã€Vue ã® computed ã‚„ watch ã§ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ä½¿ã†å ´åˆã¯ã€ctx ã‚’ reactive ã«ã—ã¦ãŠãã¨è‡ªå‹•ã§æ›´æ–°ã•ã‚Œã¾ã™

ä¾‹
const props = defineProps<{ docMode: DocMode, constrType: string }>()
const piniaStore = useDocStore() // submissionTypeã‚’ä¿æŒ
const apiData = ref({ freeInput: true, docStatus: "draft" })

const ctx = reactive({
  docMode: props.docMode,
  constrType: props.constrType,
  submissionType: piniaStore.submissionType,
  freeInput: apiData.value.freeInput,
  docStatus: apiData.value.docStatus,
})

const rules = computed(() => getRulesForContext(ctx))
ctx ã¯ props / Pinia / API ãªã©ã‚’ã¾ã¨ã‚ãŸ 1ã¤ã®ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

rules ã¯ computed ã§è‡ªå‹•æ›´æ–°ã•ã‚Œã‚‹

æ¡ä»¶å€¤ãŒå¤‰ã‚ã‚Œã°ã€è‡ªå‹•ã§å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® visible/editable ãŒåæ˜ ã•ã‚Œã¾ã™

ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ

ctx ã®å„å€¤ã¯ã©ã“ã‹ã‚‰æ¥ã¦ã‚‚è‰¯ã„ï¼ˆprops, store, API ãªã©ï¼‰

æœ€çµ‚çš„ã« getRules é–¢æ•°ã«æ¸¡ã™æ™‚ç‚¹ã§å€¤ãŒæƒã£ã¦ã„ã‚‹ã“ã¨ ãŒé‡è¦

APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãªã©éåŒæœŸãƒ‡ãƒ¼ã‚¿ã¯ã€ref ã‚„ reactive ã§ç®¡ç†ã—ã¦ãŠã‘ã°è‡ªç„¶ã«åæ˜ ã•ã‚Œã¾ã™

å¿…è¦ã§ã‚ã‚Œã°ã€åƒ•ãŒ props/Pinia/APIæ··åˆã§ã‚‚ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«å‹•ãå®Œå…¨ã‚µãƒ³ãƒ—ãƒ« ã‚’ä½œã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ä½œã£ã¦ã»ã—ã„ã§ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ã™ã„ã¾ã›ã‚“ã€æ–¹é‡ã¨ã—ã¦reactiveã§ã¯ãªãrefã‚’ä½¿ã„ãŸã„ã§ã™
ChatGPT:
ãªã‚‹ã»ã©ã§ã™ ğŸ‘
reactive ã§ã¯ãªã ref ã§1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†ã™ã‚‹æ–¹å¼ ã§ã‚‚å•é¡Œãªãå®Ÿè£…ã§ãã¾ã™ã€‚

ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

1. ref ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç®¡ç†
import { ref, computed } from 'vue'
import { DocMode, DecisionField } from '~/composables/tmp'
import { getRulesForContext } from './ruleMatrix'

type Context = {
  docMode: DocMode
  constrType: string
  submissionType: string
  freeInput: boolean
  docStatus: string
}

// refã§1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ä¿æŒ
const ctx = ref<Context>({
  docMode: DocMode.Create,
  constrType: 'A',
  submissionType: 'draft',
  freeInput: true,
  docStatus: 'draft',
})
2. computed ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’å–å¾—
const rules = computed(() => getRulesForContext(ctx.value))
ctx.value ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ã€è‡ªå‹•ã§ rules ã‚‚å†è¨ˆç®—ã•ã‚Œã¾ã™

ref ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ›¸ãæ›ãˆã‚‹å ´åˆã¯ å¿…ãš ctx.value.xxx = ... ã‚’ä½¿ã†ã“ã¨

3. ä½¿ç”¨ä¾‹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã§åæ˜ ï¼‰
<v-text-field
  v-if="rules.value?.[DecisionField.DocName]?.visible"
  v-model="form.docName"
  :disabled="!rules.value?.[DecisionField.DocName]?.editable"
/>
ãƒ¡ãƒªãƒƒãƒˆ
ref 1ã¤ã§ç®¡ç†ã§ãã‚‹ã®ã§ reactive ã‚ˆã‚Šæ‰±ã„ãŒã‚·ãƒ³ãƒ—ãƒ«

props / Pinia / API ãªã©ã‹ã‚‰å€¤ã‚’ã¾ã¨ã‚ã¦ ctx.value.xxx = ... ã§æ›´æ–°å¯èƒ½

computed ã¨çµ„ã¿åˆã‚ã›ã‚Œã°ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«åæ˜ ã•ã‚Œã‚‹

ğŸ’¡ æ³¨æ„ç‚¹

ctx.value å†…ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç½®ãæ›ãˆãªã„ ã§ãã ã•ã„ã€‚

// NG: ã“ã‚Œã¯ rules ãŒæ›´æ–°ã•ã‚Œãªã„å ´åˆãŒã‚ã‚‹
ctx.value = { ...ctx.value, docMode: DocMode.View } 
â†’ ctx.value.docMode = DocMode.View ã®ã‚ˆã†ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å˜ä½ã§æ›´æ–°ã™ã‚‹ã®ãŒå®‰å…¨ã§ã™

å¿…è¦ã§ã‚ã‚Œã°ã€props / Pinia / API ã™ã¹ã¦æ··åœ¨ã§ã‚‚å‹•ã ref ãƒ™ãƒ¼ã‚¹ã®å®Œå…¨ã‚µãƒ³ãƒ—ãƒ« ã‚’ä½œã‚Œã¾ã™ã€‚
ä½œã‚Šã¾ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ãŠé¡˜ã„ã—ã¾ã™
ChatGPT:
äº†è§£ã§ã™ ğŸ‘
ã§ã¯ props / Pinia / API ã™ã¹ã¦æ··åœ¨ã§ã€ref ãƒ™ãƒ¼ã‚¹ã§ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«å‹•ããƒ•ã‚©ãƒ¼ãƒ åˆ¶å¾¡ã‚µãƒ³ãƒ—ãƒ« ã‚’ä½œã‚Šã¾ã™ã€‚

1. å‰æï¼šå‹å®šç¾©ã¨ DecisionField / DocMode
// types.ts
export enum DecisionField {
  DocType,
  DocName,
  DocSubject,
  CreatedAt,
  PrimaryFlg,
}

export enum DocMode {
  Create,
  Edit,
  EditAfterProposal,
  View,
}

export type Context = {
  docMode: DocMode
  constrType: string
  submissionType: string
  freeInput: boolean
  docStatus: string
}

export type FieldRules = Record<DecisionField, { visible: boolean; editable: boolean }>
2. ãƒ«ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆExcelã‹ã‚‰å¤‰æ›ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
// ruleMatrix.ts
import { DecisionField, DocMode, FieldRules, Context } from './types'

export type RuleEntry = {
  ctx: Partial<Context> // éƒ¨åˆ†æŒ‡å®šã§ã‚‚OK
  rules: FieldRules
}

// ä¾‹: æ¡ä»¶ã”ã¨ã®ãƒ«ãƒ¼ãƒ«ã‚’åˆ—æŒ™
export const ruleMatrix: RuleEntry[] = [
  {
    ctx: { docMode: DocMode.Create, docStatus: 'draft' },
    rules: {
      [DecisionField.DocType]: { visible: true, editable: true },
      [DecisionField.DocName]: { visible: true, editable: true },
      [DecisionField.DocSubject]: { visible: true, editable: true },
      [DecisionField.CreatedAt]: { visible: true, editable: false },
      [DecisionField.PrimaryFlg]: { visible: true, editable: false },
    }
  },
  {
    ctx: { docMode: DocMode.View },
    rules: {
      [DecisionField.DocType]: { visible: true, editable: false },
      [DecisionField.DocName]: { visible: true, editable: false },
      [DecisionField.DocSubject]: { visible: true, editable: false },
      [DecisionField.CreatedAt]: { visible: true, editable: false },
      [DecisionField.PrimaryFlg]: { visible: true, editable: false },
    }
  },
]
3. ãƒ«ãƒ¼ãƒ«å–å¾—é–¢æ•°
// useRules.ts
import { ruleMatrix } from './ruleMatrix'
import type { Context, FieldRules, DecisionField } from './types'

export function getRulesForContext(ctx: Context): FieldRules | undefined {
  // ruleMatrix å†…ã§ ctx ã«ãƒãƒƒãƒã™ã‚‹æœ€åˆã®ãƒ«ãƒ¼ãƒ«ã‚’è¿”ã™
  return ruleMatrix.find(entry =>
    Object.entries(entry.ctx).every(([k, v]) => (ctx as any)[k] === v)
  )?.rules
}
4. Vue / Nuxt ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹
<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { DecisionField, DocMode, FieldRules, Context } from '~/types'
import { getRulesForContext } from '~/ruleMatrix'
import { useDocStore } from '~/stores/doc'

// props ã‹ã‚‰ä¸€éƒ¨å–å¾—
const props = defineProps<{
  docMode: DocMode
  constrType: string
}>()

// Pinia store ã‹ã‚‰å–å¾—
const store = useDocStore() // submissionType ãªã©ã‚’ä¿æŒ

// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¾‹
const apiData = ref({ freeInput: true, docStatus: 'draft' })

// ctx ã‚’ ref ã§ã¾ã¨ã‚ã‚‹
const ctx = ref<Context>({
  docMode: props.docMode,
  constrType: props.constrType,
  submissionType: store.submissionType,
  freeInput: apiData.value.freeInput,
  docStatus: apiData.value.docStatus,
})

// APIã®æ›´æ–°ãŒã‚ã‚Œã° ctx ã‚‚æ›´æ–°
watch(apiData, (val) => {
  ctx.value.freeInput = val.freeInput
  ctx.value.docStatus = val.docStatus
})

// ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’ computed ã§å–å¾—
const rules = computed<FieldRules | undefined>(() => getRulesForContext(ctx.value))

// ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
const form = ref({
  docType: '',
  docName: '',
  docSubject: '',
  createdAt: '',
  primaryFlg: false
})
</script>

<template>
  <v-text-field
    v-if="rules?.[DecisionField.DocName]?.visible"
    v-model="form.docName"
    label="Document Name"
    :disabled="!rules?.[DecisionField.DocName]?.editable"
  />

  <v-text-field
    v-if="rules?.[DecisionField.DocType]?.visible"
    v-model="form.docType"
    label="Document Type"
    :disabled="!rules?.[DecisionField.DocType]?.editable"
  />
</template>
ğŸ”¹ ãƒã‚¤ãƒ³ãƒˆ
ctx ã¯ ref ã§1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ç®¡ç†

props, Pinia, API ãªã©ã®å€¤ã‚’ã¾ã¨ã‚ã¦ä»£å…¥

APIã®éåŒæœŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚‚ watch ã§æ›´æ–°å¯èƒ½

computed ã§ãƒ«ãƒ¼ãƒ«ã‚’ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«å–å¾—

ctx ãŒå¤‰ã‚ã‚Œã°è‡ªå‹•ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® visible/editable ãŒåæ˜ 

ãƒ•ã‚©ãƒ¼ãƒ ã¯ ref ã§ç®¡ç†

v-model ã¨çµ„ã¿åˆã‚ã›ã¦ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒã‚¤ãƒ³ãƒ‰

ã“ã‚Œã§ props / Pinia / API æ··åˆã§ã‚‚ã€refãƒ™ãƒ¼ã‚¹ã§ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºãƒ»ç·¨é›†åˆ¶å¾¡ ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ã‚‚ã—å¸Œæœ›ãªã‚‰ã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ ã€ŒfieldRulesã‚’Map<DecisionField, Rule[]> ã«ã—ã¦æ¡ä»¶ã‚’éƒ¨åˆ†æŒ‡å®šã§åˆ—æŒ™ã™ã‚‹å½¢å¼ã€ ã«æ‹¡å¼µã—ã¦ã€ã•ã‚‰ã« Excel ã®è¡Œã‚’ãã®ã¾ã¾è²¼ã‚Œã‚‹å½¢ã«ã‚‚ã§ãã¾ã™ã€‚

ä½œã‚Šã¾ã™ã‹ï¼Ÿ

ã‚ãªãŸ:
ã™ã¿ã¾ã›ã‚“ã€ã‚­ãƒ¼ãŒDecisionFieldã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ãŠé¡˜ã„ã—ã¾ã™
ChatGPT:
äº†è§£ã§ã™ ğŸ‘
ã§ã¯ ã‚­ãƒ¼ãŒ DecisionField å›ºå®šã§ã€æ¡ä»¶ã‚’åˆ—æŒ™ã—ã¦ç®¡ç†ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚
ã“ã®æ–¹å¼ã ã¨ã€Excelã®ã€Œ1åˆ—ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€è¤‡æ•°è¡Œï¼æ¡ä»¶ã‚»ãƒƒãƒˆã€ã‚’ãã®ã¾ã¾ã‚³ãƒ¼ãƒ‰åŒ–ã§ãã¾ã™ã€‚

1. å‹å®šç¾©
// types.ts
import { DocMode } from './modes'

export enum DecisionField {
  DocType,
  DocName,
  DocSubject,
  CreatedAt,
  PrimaryFlg,
}

export type Context = {
  docMode: DocMode
  constrType: string
  submissionType: string
  freeInput: boolean
  docStatus: string
}

export type Rule = {
  when: Partial<Context> // æ¡ä»¶ã‚’éƒ¨åˆ†æŒ‡å®š
  editable: boolean
  visible: boolean
}

export type FieldRulesMap = Map<DecisionField, Rule[]>
2. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã®ãƒ«ãƒ¼ãƒ«å®šç¾©ï¼ˆMapï¼‰
import { DecisionField, DocMode, Rule, FieldRulesMap } from './types'

export const fieldRules: FieldRulesMap = new Map<DecisionField, Rule[]>([
  [
    DecisionField.DocName,
    [
      {
        when: { docMode: DocMode.Create, docStatus: 'draft' },
        editable: true,
        visible: true,
      },
      {
        when: { docMode: DocMode.View },
        editable: false,
        visible: true,
      },
    ],
  ],
  [
    DecisionField.DocType,
    [
      {
        when: { docMode: DocMode.Edit, constrType: 'A' },
        editable: false,
        visible: true,
      },
      {
        when: { docMode: DocMode.Create },
        editable: true,
        visible: true,
      },
    ],
  ],
  [
    DecisionField.CreatedAt,
    [
      { when: { docMode: DocMode.Create }, editable: false, visible: false },
      { when: { docMode: DocMode.View }, editable: false, visible: true },
    ],
  ],
])
3. æ¡ä»¶ã«ãƒãƒƒãƒã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’å–å¾—ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
import type { Context, DecisionField, Rule } from './types'
import { fieldRules } from './fieldRules'

export function getFieldState(field: DecisionField, ctx: Context): { editable: boolean; visible: boolean } {
  const rules: Rule[] = fieldRules.get(field) ?? []
  
  for (const rule of rules) {
    const matched = Object.entries(rule.when).every(([k, v]) => (ctx as any)[k] === v)
    if (matched) {
      return { editable: rule.editable, visible: rule.visible }
    }
  }

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å…¨ã¦éè¡¨ç¤ºãƒ»ç·¨é›†ä¸å¯
  return { editable: false, visible: false }
}
4. Vue / Nuxt3 ã§ã®åˆ©ç”¨ä¾‹ï¼ˆrefãƒ™ãƒ¼ã‚¹ï¼‰
<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { DecisionField, Context } from '~/types'
import { getFieldState } from '~/fieldRules'
import { useDocStore } from '~/stores/doc'
import { DocMode } from '~/types'

// props
const props = defineProps<{ docMode: DocMode, constrType: string }>()

// Pinia store
const store = useDocStore()

// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹
const apiData = ref({ freeInput: true, docStatus: 'draft' })

// ctx ã‚’ ref ã§ã¾ã¨ã‚ã‚‹
const ctx = ref<Context>({
  docMode: props.docMode,
  constrType: props.constrType,
  submissionType: store.submissionType,
  freeInput: apiData.value.freeInput,
  docStatus: apiData.value.docStatus,
})

// APIãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã« ctx ã‚’æ›´æ–°
watch(apiData, (val) => {
  ctx.value.freeInput = val.freeInput
  ctx.value.docStatus = val.docStatus
})

// ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
const form = ref({
  docType: '',
  docName: '',
  docSubject: '',
  createdAt: '',
  primaryFlg: false,
})

// computed ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã®çŠ¶æ…‹ã‚’å–å¾—
const docNameState = computed(() => getFieldState(DecisionField.DocName, ctx.value))
const docTypeState = computed(() => getFieldState(DecisionField.DocType, ctx.value))
</script>

<template>
  <v-text-field
    v-if="docNameState.visible"
    v-model="form.docName"
    label="Document Name"
    :disabled="!docNameState.editable"
  />

  <v-text-field
    v-if="docTypeState.visible"
    v-model="form.docType"
    label="Document Type"
    :disabled="!docTypeState.editable"
  />
</template>
âœ… ãƒã‚¤ãƒ³ãƒˆ
ã‚­ãƒ¼ãŒ DecisionField å›ºå®š

Excel ã®ã€Œåˆ—ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã«å¯¾å¿œ

1ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«è¤‡æ•°æ¡ä»¶ã®ãƒ«ãƒ¼ãƒ«ã‚’åˆ—æŒ™å¯èƒ½

æ¡ä»¶ã¯éƒ¨åˆ†æŒ‡å®šï¼ˆPartial<Context>ï¼‰

ãã®æ¡ä»¶ã«ãƒãƒƒãƒã—ãŸæœ€åˆã®ãƒ«ãƒ¼ãƒ«ã‚’æ¡ç”¨

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºãƒ»éç·¨é›†ã«ã—ã¦å®‰å…¨

ref + computed ã§ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ç®¡ç†

props / Pinia / API ãªã©æ··åœ¨ã§ã‚‚è‡ªå‹•åæ˜ 

ã“ã®æ–¹å¼ãªã‚‰ã€Excelã®åˆ—ã”ã¨ã®ãƒ«ãƒ¼ãƒ«ã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ç®¡ç†ã§ãã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚

ã‚‚ã—å¸Œæœ›ã§ã‚ã‚Œã°ã€åƒ•ãŒã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ ã€Œå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¾ã¨ã‚ã¦ computed ã§ä¸€æ‹¬å–å¾—ã§ãã‚‹å½¢ã€ ã«æ‹¡å¼µã—ã¦ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚‚ v-for ã§å›ã›ã‚‹ã‚ˆã†ã«ã§ãã¾ã™ã€‚

ä½œã‚Šã¾ã™ã‹ï¼Ÿ




é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“
ChatGPT ã®å›ç­”ã¯å¿…ãšã—ã‚‚æ­£ã—ã„ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚é‡è¦ãªæƒ…å ±ã¯ç¢ºèªã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚
